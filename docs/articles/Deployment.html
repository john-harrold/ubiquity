<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model Deployment • ubiquity</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model Deployment">
<meta property="og:description" content="ubiquity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ubiquity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-chalkboard-teacher"></span>
     
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Getting Started</li>
    <li>
      <a href="../articles/Simulation.html">Individual and Population Simulations</a>
    </li>
    <li>
      <a href="../articles/Language.html">ubiquity Modeling Language</a>
    </li>
    <li>
      <a href="../articles/Estimation.html">Naive-Pooled Parameter Estimation</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Other Analysis Options</li>
    <li>
      <a href="../articles/Deployment.html">Deploying Your Models in a Shiny App</a>
    </li>
    <li>
      <a href="../articles/Titration.html">Trial/Rule-Based Simulations</a>
    </li>
    <li>
      <a href="../articles/NCA.html">Non-Compartmental Analysis</a>
    </li>
    <li>
      <a href="../articles/Reporting.html">Integrated Word and PowerPoint Reporting</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-video"></span>
     
    Screencasts
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://vimeo.com/382859445" class="external-link">Individual and Population Simulations</a>
    </li>
    <li>
      <a href="https://vimeo.com/382860283" class="external-link">Model Deployment</a>
    </li>
    <li>
      <a href="https://vimeo.com/manage/videos/382829588" class="external-link">Naive-Pooled Parameter Estimation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa-hat-wizard"></span>
     
    Functions
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/john-harrold/ubiquity/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Deployment_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model Deployment</h1>
                        <h4 data-toc-skip class="author">John Harrold &amp; Anson K Abraham</h4>
            
            <h4 data-toc-skip class="date">2021-07-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/john-harrold/ubiquity/blob/master/vignettes/Deployment.Rmd" class="external-link"><code>vignettes/Deployment.Rmd</code></a></small>
      <div class="hidden name"><code>Deployment.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor" aria-hidden="true"></a>Introduction</h2>
<p>Once a model has been developed it may be useful to provide an easy way to run simulations or automate specific analyses. Do to that, a ubiquity provides a ShinyApp that allows the model to be run from an easy to use interface that is highly customizable. This App can be run locally (useful during meetings to answer quick questions) or deployed on a Shiny server to allow others access to the model.</p>
<p>To demonstrate this interface we can begin with the PK model of mAbs in humans (<a href="https://doi.org/10.4161/mabs.29095" class="external-link">Davda etal. mAbs, 6(4), 1094-1102</a>) :</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ubiquity.tools/rworkflow" class="external-link">ubiquity</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/system_new.html">system_new</a></span><span class="op">(</span>file_name <span class="op">=</span> <span class="st">"system.txt"</span>, system_file <span class="op">=</span> <span class="st">"mab_pk"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">cfg</span> <span class="op">=</span> <span class="fu"><a href="../reference/build_system.html">build_system</a></span><span class="op">(</span>system_file <span class="op">=</span> <span class="st">"system.txt"</span><span class="op">)</span></code></pre></div>
<p>Use <code><a href="../reference/system_new.html">?system_new</a></code> to see a list of the available system file examples. After building any system you can then create the ShinyApp template:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/system_fetch_template.html">system_fetch_template</a></span><span class="op">(</span><span class="va">cfg</span>, template <span class="op">=</span> <span class="st">"ShinyApp"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>This should create the following three files:</p>
<ul>
<li>
<code>ubiquity_app.R</code> - Script to run and control ubiquity ShinyApp</li>
<li>
<code>server.R</code> - Server script</li>
<li>
<code>ui.R</code>- UI script</li>
</ul>
</div>
<div id="running-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#running-the-model" class="anchor" aria-hidden="true"></a>Running the model</h2>
<p>Next simply open <code>ubiquity_app.R</code> in RStudio and source it, and RStudio will open in a window associated with that application. The ShinyApp tends to work better when run within a browser.</p>
<p>After starting the App will load the default dosing from the  file and run the model. The first model output will be plotted. And as you make changes to the App, those changes will be reflected in the user log at the bottom of the screen. You can change the outputs being plotted, the axis limits, and other aspects of the plot using the plot controls below the figure.</p>
<div class="figure">
<img src="ShinyApp-ss-Initialization.png" style="width:80.0%" alt=""><p class="caption">ShinyApp interface after initialization</p>
</div>
<p>The intent is to provide a quick method to get the model up and running with default behaviors that will provide for most of what users will need. The behavior of the ShinyApp can be further customized (described below). First we will discuss the default interface:</p>
<div id="altering-dosing" class="section level3">
<h3 class="hasAnchor">
<a href="#altering-dosing" class="anchor" aria-hidden="true"></a>Altering dosing</h3>
<p>A list of bolus times and values can be specified as comma-separated values. To dose in a repeated fashion check the ``Repeat the last dose’’ box, provide a dosing interval (in the same units as the dosing times), and give the number of doses to administer. The example here will repeat the 400 mg dose every two weeks for two doses.</p>
<div class="figure">
<img src="ShinyApp-ss-Bolus.png" style="width:50.0%" alt=""><p class="caption">Bolus Dosing</p>
</div>
<p>Rates of infusion are specified as a set of switching times and corresponding infusion rates (both separated by commas). The infusion rates are held constant until the next switching time. The example here would infuse the drug at 800mg/min starting at time 0, and the infusion will be turned off (set to 0) after 30 minutes.</p>
<div class="figure">
<img src="ShinyApp-ss-Infusion.png" style="width:50.0%" alt=""><p class="caption">Continuous Infusion</p>
</div>
</div>
<div id="population-simulations" class="section level3">
<h3 class="hasAnchor">
<a href="#population-simulations" class="anchor" aria-hidden="true"></a>Population simulations</h3>
<p>If the variability for system parameters has been specified (<code>&lt;IIV:?&gt;?</code> and <code>&lt;IIVCOR:?&gt;?</code>) then a “Variability” tab will be visible. Simply check the “Simulate with variability” box, alter the number of subjects, prediction interval, and elements of the variance-covariance matrix to simulate the desired population response.</p>
<div class="figure">
<img src="ShinyApp-ss-IIV.png" style="width:50.0%" alt=""><p class="caption">Population simulation options</p>
</div>
<p>When you select “Update Plot”, each selected output will be plotted (mean – solid line, selected confidence interval – shaded region).</p>
<div class="figure">
<img src="ShinyApp-ss-Pop_timecourse.png" style="width:80.0%" alt=""><p class="caption">Population timecourse</p>
</div>
</div>
</div>
<div id="saving-model-results" class="section level2">
<h2 class="hasAnchor">
<a href="#saving-model-results" class="anchor" aria-hidden="true"></a>Saving model results</h2>
<div class="figure">
<img src="ShinyApp-ss-Save.png" style="width:60.0%" alt=""><p class="caption">Saving an analysis</p>
</div>
<p>To save the model results you need to only provide a descriptive name for the analysis, push the save button, and click on the link that is generated. If you select the time stamp, this will be appended to the name of the zip file. By default the following files will be saved:</p>
<ul>
<li>
<code>analysis_single_dose_400_mg_lib.r</code>, <code>analysis_single_dose_400_mg.r</code> - These two files can be used to recreate the results from the ShinyApp.</li>
<li>
<code>analysis_single_dose_400_mg_timecourse.png</code> - Time-course with the simulation results</li>
<li>
<code>analysis_single_dose_400_mg.csv</code> - Predictions containing each timescale in the model, every state, and output</li>
<li>
<code>analysis_single_dose_400_mg_RX.html</code> - A file for each report (X) that has been specified in <code>ubiquity_app.R</code> (See below)</li>
<li>
<code>system.txt</code> - The system file describing the model</li>
<li>
<code>ubiquity_log.txt</code> - The log file of what the user has done</li>
</ul>
<div id="model-scripts" class="section level3">
<h3 class="hasAnchor">
<a href="#model-scripts" class="anchor" aria-hidden="true"></a>Model scripts</h3>
<p>The files <code>analysis_NAME.r</code> and <code>analysis_NAME_lib.r</code> can be used in two ways. First, these two files can be used as stand-alone files to recreate the simulation results from the ShinyApp. Creating Simulation Scripts The main script (<code>analysis_NAME.r</code>) can be used as a starting point to create simulation scripts. To do this it is necessary to modify First comment out the sourcing of the standalone library:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#source("analysis_NAME_lib.r");</span></code></pre></div>
<p>Next (with this script and the <code>system.txt</code> file) uncommenting the following lines that will force the system to be rebuilt and any changes to the system file loaded.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://ubiquity.tools/rworkflow" class="external-link">ubiquity</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">'library'</span>, <span class="st">'r_general'</span>, <span class="st">'ubiquity.R'</span><span class="op">)</span><span class="op">)</span> <span class="op">}</span>
<span class="va">cfg</span> <span class="op">=</span> <span class="fu"><a href="../reference/build_system.html">build_system</a></span><span class="op">(</span>system_file<span class="op">=</span><span class="st">"system.txt"</span><span class="op">)</span></code></pre></div>
</div>
<div id="controlling-what-is-saved" class="section level3">
<h3 class="hasAnchor">
<a href="#controlling-what-is-saved" class="anchor" aria-hidden="true"></a>Controlling what is saved</h3>
<p>In certain instances you may not want to allow the user access to everything that is saved by default. If you edit the <code>ubiquity_app.R</code> you can alter what is being pushed to the user by setting the relevant fields to <code>FALSE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfg</span><span class="op">$</span><span class="va">gui</span><span class="op">$</span><span class="va">save</span><span class="op">$</span><span class="va">system_txt</span> <span class="op">=</span> <span class="cn">TRUE</span>
<span class="va">cfg</span><span class="op">$</span><span class="va">gui</span><span class="op">$</span><span class="va">save</span><span class="op">$</span><span class="va">user_log</span>   <span class="op">=</span> <span class="cn">TRUE</span></code></pre></div>
</div>
</div>
<div id="model-documentation" class="section level2">
<h2 class="hasAnchor">
<a href="#model-documentation" class="anchor" aria-hidden="true"></a>Model documentation</h2>
<div id="model-diagram" class="section level3">
<h3 class="hasAnchor">
<a href="#model-diagram" class="anchor" aria-hidden="true"></a>Model diagram</h3>
<p>It can be difficult for a user to look at a set of parameters, dosing inputs, and outputs and determine how a model works. To aid the user it can be useful to create a model diagram. To utilize the majority of the screen space, the image should be roughly twice as wide as it is tall.</p>
<p>You can create this image in your favorite drawing program. Inkscape is a free vector drawing program available at <a href="https://inkscape.org" class="external-link">inkscape.org</a>. If you run the following:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/system_fetch_template.html">system_fetch_template</a></span><span class="op">(</span><span class="va">cfg</span>, template<span class="op">=</span><span class="st">"Model Diagram"</span><span class="op">)</span></code></pre></div>
<p>it will create the file <code>system.svg</code>. You can edit it and save it as a portable network graphics (png) file named <code>system.png</code> in the directory with the <code>ubiquity_app.R</code> file. When you start the ShinyApp it should find that file and create a tab in the plotting area of the App.</p>
</div>
<div id="model-reports" class="section level3">
<h3 class="hasAnchor">
<a href="#model-reports" class="anchor" aria-hidden="true"></a>Model reports</h3>
<p>Sometimes you need more detail than an annotated model diagram. Or you may need to perform some calculations based on the results of a simulation. It may be better to present information in a tabulated format. For these scenarios you can create an RMarkdown file. Create a copy the report template (<code>system_report.Rmd</code>) and a script to test it (<code>test_system_report.r</code>):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/system_fetch_template.html">system_fetch_template</a></span><span class="op">(</span><span class="va">cfg</span>, template<span class="op">=</span><span class="st">"Shiny Rmd Report"</span><span class="op">)</span></code></pre></div>
<p>When this is called you’ll have access to the ubiquity model object (<code>cfg</code>) and the simulation results <code>som</code>. The simulation results will take the form of a deterministic simulation (see the output of <code><a href="../reference/run_simulation_ubiquity.html">?run_simulation_ubiquity</a></code>) or, if variability is checked, a stochastic simulation (see output of <code><a href="../reference/simulate_subjects.html">?simulate_subjects</a></code>)</p>
<p>To tell the ShinyApp to load the report (named <code>system_report.Rmd</code>), the following lines need to be added to <code>ubiquity_app.R</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfg</span><span class="op">$</span><span class="va">gui</span><span class="op">$</span><span class="va">modelreport_files</span><span class="op">$</span><span class="va">R1</span><span class="op">$</span><span class="va">title</span> <span class="op">=</span> <span class="st">"Tab Title"</span>
<span class="va">cfg</span><span class="op">$</span><span class="va">gui</span><span class="op">$</span><span class="va">modelreport_files</span><span class="op">$</span><span class="va">R1</span><span class="op">$</span><span class="va">file</span>  <span class="op">=</span> <span class="st">"system_report.Rmd"</span></code></pre></div>
<p>The <code>title</code> field is the title of the tab in the ShinyApp and <code>file</code> is the name of the file that you created. You can create up to five reports this way, and these are differentiated by the list name (<code>R1</code>, <code>R2</code>, … <code>R5</code>).</p>
<p>The file <code>test_system_report.r</code> can be used to debug your model report file. First run your model in the ShinyApp with the reports disabled. When the App runs it stores the state (<code>cfg</code>) and the current simulation results (<code>som</code>) in the following data files:</p>
<ul>
<li>
<code>cfg</code> <span class="math inline">\(\rightarrow\)</span> <code>transient/rgui/default/gui_state.RData</code>
</li>
<li>
<code>som</code> <span class="math inline">\(\rightarrow\)</span> <code>transient/rgui/default/gui_som.RData</code>
</li>
</ul>
<p>Next load the test script, modify the report name accordingly, and run it:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"transient/rgui/default/gui_som.RData"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"transient/rgui/default/gui_state.RData"</span><span class="op">)</span>
<span class="va">params</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">params</span><span class="op">$</span><span class="va">cfg</span> <span class="op">=</span> <span class="va">cfg</span>
<span class="va">params</span><span class="op">$</span><span class="va">som</span> <span class="op">=</span> <span class="va">som</span>
<span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">render</a></span><span class="op">(</span><span class="st">"system_report.Rmd"</span>,
                   params <span class="op">=</span> <span class="va">params</span>,
                   output_format <span class="op">=</span> <span class="st">"html_document"</span><span class="op">)</span></code></pre></div>
<p>This should generate your report in HTML format. You can insert debugging commands in the report and test it while you add information. Once you have it working, you can enable the report as described above and it should appear as a tab viewable by the user.</p>
<p>Not all reports may depend on user input. For example, if you have an RMarkdown file that documents your modeling assumptions or the model construction process then the content will not change as the user interacts with the App. To use a pre-rendered report you simply have to replace <code>.Rmd</code> with <code>.html</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfg</span><span class="op">$</span><span class="va">gui</span><span class="op">$</span><span class="va">modelreport_files</span><span class="op">$</span><span class="va">R1</span><span class="op">$</span><span class="va">title</span> <span class="op">=</span> <span class="st">"Tab Title"</span>
<span class="va">cfg</span><span class="op">$</span><span class="va">gui</span><span class="op">$</span><span class="va">modelreport_files</span><span class="op">$</span><span class="va">R1</span><span class="op">$</span><span class="va">file</span>  <span class="op">=</span> <span class="st">"system_report.html"</span></code></pre></div>
<p>This will tell the App to read in the html, prevent rendering the report, and speed things up for the user.</p>
</div>
</div>
<div id="user-definable-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#user-definable-functions" class="anchor" aria-hidden="true"></a>User definable functions</h2>
<p>To customize the simulation and plotting within the ShinyApp it is necessary to create custom functions. These need to be placed in a file. For example these could be placed in <code>mylibs.r</code> in the main template directory. Lastly, you need to tell the ShinyApp to load this file. You need to edit <code>ubiquity_app.R</code> and add the following line:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfg</span><span class="op">$</span><span class="va">gui</span><span class="op">$</span><span class="va">functions</span><span class="op">$</span><span class="va">user_def</span> <span class="op">=</span> <span class="st">'mylibs.r'</span></code></pre></div>
<div id="custom-simulation-commands" class="section level3">
<h3 class="hasAnchor">
<a href="#custom-simulation-commands" class="anchor" aria-hidden="true"></a>Custom simulation commands</h3>
<p>By default the ShinyApp will run simulations using <code>run_simulation_ubiquity</code> (individual) or <code>simulate_subjects</code> (population). These take as inputs the <code>parameters</code> vector containing the current parameter set with any changes made through the interface and <code>cfg</code> data structure. You can create your own functions and overwrite these by defining the following:</p>
<p><strong>Individual Simulations</strong></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfg</span><span class="op">$</span><span class="va">gui</span><span class="op">$</span><span class="va">functions</span><span class="op">$</span><span class="va">sim_ind</span> <span class="op">=</span> <span class="st">'function_name(parameters, cfg)'</span></code></pre></div>
<p><strong>Population Simulations</strong></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfg</span><span class="op">$</span><span class="va">gui</span><span class="op">$</span><span class="va">functions</span><span class="op">$</span><span class="va">sim_var</span> <span class="op">=</span> <span class="st">'function_name(parameters, cfg)'</span></code></pre></div>
<p>Note that in order to use the default plotting functionality these functions need to return values in the same format as the default functions for individual (<code>run_simulation_ubiquity</code>) and population (<code>simulate_subjects</code>) simulations.</p>
</div>
<div id="custom-plotting-commands" class="section level3">
<h3 class="hasAnchor">
<a href="#custom-plotting-commands" class="anchor" aria-hidden="true"></a>Custom plotting commands</h3>
<p>To customize the plotting output you need to create functions that can utilize the simulation output <code>som</code>. For individual and population simulations this is the output of <code>run_simulation_ubiquity</code> and <code>simulate_subjects</code>, respectively. Unless user-specified simulation functions are being used. In that case <code>som</code> can have any format needed. It is possible to also access the <code>parameters</code> vector containing current parameter set with any changes made through the interface and <code>cfg</code> data structure. You can create your own plotting functions and overwrite these by defining the following in <code>ubiquity_app.R</code>:</p>
<p><strong>Indiviudal Plot</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfg</span><span class="op">$</span><span class="va">gui</span><span class="op">$</span><span class="va">functions</span><span class="op">$</span><span class="va">plot_ind</span> <span class="op">=</span>  <span class="st">'function_name(cfg, parameters,som)'</span></code></pre></div>
<p><strong>Population Plot</strong></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfg</span><span class="op">$</span><span class="va">gui</span><span class="op">$</span><span class="va">functions</span><span class="op">$</span><span class="va">plot_var</span> <span class="op">=</span>  <span class="st">'function_name(cfg, parameters,som)'</span></code></pre></div>
</div>
</div>
<div id="deployment-on-a-shiny-server" class="section level2">
<h2 class="hasAnchor">
<a href="#deployment-on-a-shiny-server" class="anchor" aria-hidden="true"></a>Deployment on a Shiny Server</h2>
<p>To deploy the ShinyApp on a shiny server you need to indicate this by modifying <code>ubiquity_app.R</code> and changing the deploying variable to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">deploying</span> <span class="op">=</span> <span class="cn">TRUE</span></code></pre></div>
<p>Then the ShinyApp needs to be initialized on the server. You can do this two ways. First you can create an empty file called <code>REBUILD</code> that needs to be deployed along side the other app files. You can do this with the <code>touch</code> command from the <code>nat.utils</code> package:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">nat.utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nat.utils/man/touch.html" class="external-link">touch</a></span><span class="op">(</span><span class="st">"REBUILD"</span><span class="op">)</span></code></pre></div>
<p>This will force the initialization the first time the app is loaded. This works well if you are using <code>rsconnect</code> to deploy your app. Alternatively, you can manually sync the files and run the following <strong>as the shiny user</strong> on the server.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>R <span class="sc">-</span>e <span class="st">"source('ubiquity_app.R')"</span></span></code></pre></div>
<p>If the App fails to run on the Shiny Server check the following:</p>
<ul>
<li>Make sure all of the correct packages have been installed and are available to the user the Shiny Server is running under.</li>
<li>Make sure the ownership and permissions on the server files is correct.</li>
</ul>
<p>To test deployment you can install the <a href="https://github.com/nsh87/shinyVM" class="external-link">shinyVM</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by John Harrold.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
