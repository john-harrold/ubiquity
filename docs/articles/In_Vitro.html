<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analysis of Static Systems, an In Vitro Example â€¢ ubiquity</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet">
<script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysis of Static Systems, an In Vitro Example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ubiquity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-chalkboard-teacher"></span> Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/Simulation.html">Individual and Population Simulations</a></li>
    <li><a class="dropdown-item" href="../articles/Language.html">ubiquity Modeling Language</a></li>
    <li><a class="dropdown-item" href="../articles/Estimation.html">Naive-Pooled Parameter Estimation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other Analysis Options</h6></li>
    <li><a class="dropdown-item" href="../articles/Deployment.html">Deploying Your Models in a Shiny App</a></li>
    <li><a class="dropdown-item" href="../articles/Titration.html">Trial/Rule-Based Simulations</a></li>
    <li><a class="dropdown-item" href="../articles/In_Vitro.html">Estimation of In Vitro/Static Systems</a></li>
    <li><a class="dropdown-item" href="../articles/NCA.html">Non-Compartmental Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Reporting.html">Integrated Word and PowerPoint Reporting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>More Help</h6></li>
    <li><a class="dropdown-item" href="../articles/Howto.html">Howtos</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-screencasts" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-video"></span> Screencasts</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-screencasts">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modeling</h6></li>
    <li><a class="external-link dropdown-item" href="https://vimeo.com/382859445">Individual and Population Simulations</a></li>
    <li><a class="external-link dropdown-item" href="https://vimeo.com/382860283">Model Deployment</a></li>
    <li><a class="external-link dropdown-item" href="https://vimeo.com/manage/videos/382829588">Naive-Pooled Parameter Estimation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other Tools</h6></li>
    <li><a class="external-link dropdown-item" href="https://vimeo.com/650643574">Tabula: Extracting Tabular Data from PDFs</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fas fa-hat-wizard"></span> Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fas fa-rss"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/john-harrold/ubiquity/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="In_Vitro_files/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="In_Vitro_files/tabwid-1.1.3/tabwid.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Analysis of Static Systems, an In Vitro Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/john-harrold/ubiquity/blob/HEAD/vignettes/In_Vitro.Rmd" class="external-link"><code>vignettes/In_Vitro.Rmd</code></a></small>
      <div class="d-none name"><code>In_Vitro.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><strong>This tutorial requires ubiquity 2.04 or greater. Currently
this is only available using the development version off of
github</strong></p>
<p>Sometimes we need to analyze data where the independent variable is
not time. You can do this with ubiquity and this tutorial will highlight
how that is done. If you have not done so already, please review the
naive-pooled parameter estimation tutorial because this will build on
the concepts covered there. The workshop (<a href="https://ubiquity-pkpd.s3-us-west-1.amazonaws.com/files/ubiquity_workshop.zip" class="external-link">workshop.ubiquity.tools</a>)
provides an example of how to analyize static <em>in vitro</em> data. To
make a copy of these scripts and other supporting files in the current
working directory run the following:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.ubiquity.tools">ubiquity</a></span><span class="op">)</span></span>
<span><span class="va">fr</span> <span class="op">=</span> <span class="fu"><a href="../reference/workshop_fetch.html">workshop_fetch</a></span><span class="op">(</span>section<span class="op">=</span><span class="st">"In Vitro"</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This should create the following files in your current working
direcotry:</p>
<ul>
<li>
<code>system-in_vitro.txt</code> - System file that can be run both
<em>in vivo</em> and <em>in vitro</em>
</li>
<li>
<code>in_vitro_er_data.csv</code>- <em>In vitro</em> data file</li>
<li>
<code>mk_data_in_vitro.R</code>- Script to generate <em>in
vitro</em> data</li>
<li>
<code>analysis_in_vitro.R</code>- Script to perform parameter
estimation using the <em>in vitro</em> data</li>
</ul>
<p>This example uses a system from <a href="https://jpharmsci.org/article/S0022-3549(16)31001-2/abstract" class="external-link">Chakraborty
and Jusko. J Pharm Sci 91(5), 1334-1342</a>. Specifically equation 5
from that article where the effect of two drugs, A and B, is driven by
their concentrations (<span class="math inline">C_A</span>, and <span class="math inline">C_B</span>):</p>
<p><span class="math display">
E = 100 \left( 1-
    \frac{
      \frac{I_{max,A}(C_A)    ^{\gamma_A}}{(\Psi IC_{50,A})^{\gamma_A}}
+
      \frac{I_{max,B}(\xi C_B)^{\gamma_B}}{(\Psi
IC_{50,B})^{\gamma_B}}  \\
       + (I_{max,A} +
       I_{max,B} +
       I_{max,A}
       I_{max,B})  \\
       \times
      \frac{(C_A)    ^{\gamma_A}}{(\Psi IC_{50,A})^{\gamma_A}} \times
      \frac{(\xi C_B)^{\gamma_B}}{(\Psi IC_{50,B})^{\gamma_B}}  \\
}{
      \frac{(C_A)    ^{\gamma_A}}{(\Psi IC_{50,A})^{\gamma_A}} +
      \frac{(\xi C_B)^{\gamma_B}}{(\Psi IC_{50,B})^{\gamma_B}}  \\
     +\frac{(C_A)    ^{\gamma_A}}{(\Psi IC_{50,A})^{\gamma_A}} \times
      \frac{(\xi C_B)^{\gamma_B}}{(\Psi IC_{50,B})^{\gamma_B}} +1
}
\right)  
</span></p>
<p><span class="math display">
\xi = \frac{IC_{50,A}}{IC_{50,B}}
</span></p>
<p>This has been implemented in the PKPD system file
(<code>system-in_vitro.txt</code>) shown at the bottom. This
implementation is dynamic meaning the effect changes with the PK of the
drug. However the effect is considered instantaneous and typically
analyzed from <em>in vitro</em> data using algebraic relationships. For
this system consider the following data:</p>
<p><img src="In_Vitro_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p>Here both the concentrations of drug A and B are altered (independent
variable) and the Effect is measured (dependent variable).</p>
</div>
<div class="section level2">
<h2 id="the-sysem-file-system-in_vitro-txt">The sysem file: <code>system-in_vitro.txt</code><a class="anchor" aria-label="anchor" href="#the-sysem-file-system-in_vitro-txt"></a>
</h2>
<p>First lets discuss the way the system file is structured. There is
bolus dosing for the PK specified, but the initial conditions of the
effect compartments are also defined in terms of system parameters:</p>
<pre><code>&lt;I&gt; Cp_A = C_A0
&lt;I&gt; Cp_B = C_B0</code></pre>
<p>These system parameters (<code>C_A0</code> and <code>C_B0</code>)
have a default value of zero. So by default the system would run like
any <em>in vivo</em> PKPD system. But these initial condition
placeholders will be used when performing <em>in vitro</em> analyses.
<strong>This allows you to use the same system file for both in vitro
and <em>in vivo</em> analyses. This is useful because you do not have to
do your static in vitro analysis in one system file and then copy and
paste to your <em>in vivo</em> dynamic system.</strong></p>
</div>
<div class="section level2">
<h2 id="the-dataset-in_vitro_er_data-csv">The dataset: <code>in_vitro_er_data.csv</code><a class="anchor" aria-label="anchor" href="#the-dataset-in_vitro_er_data-csv"></a>
</h2>
<p>This table contains a snapshot of the relevant columns of the
dataset:</p>
<div class="tabwid">
<style>.cl-cea71a32{}.cl-cea37e90{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-cea4d204{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-cea4d205{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-cea4e064{width:0.668in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e065{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e066{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e06e{width:1.509in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e06f{width:1.032in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e070{width:0.668in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e071{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e072{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e078{width:1.509in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e079{width:1.032in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e07a{width:0.668in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e082{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e083{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e084{width:1.509in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cea4e085{width:1.032in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="table cl-cea71a32">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-cea4e064"><p class="cl-cea4d204"><span class="cl-cea37e90">C_A0</span></p></th>
<th class="cl-cea4e065"><p class="cl-cea4d205"><span class="cl-cea37e90">C_B0</span></p></th>
<th class="cl-cea4e066"><p class="cl-cea4d204"><span class="cl-cea37e90">Effect</span></p></th>
<th class="cl-cea4e06e"><p class="cl-cea4d205"><span class="cl-cea37e90">treat</span></p></th>
<th class="cl-cea4e06f"><p class="cl-cea4d204"><span class="cl-cea37e90">samp_time</span></p></th>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-cea4e070"><p class="cl-cea4d204"><span class="cl-cea37e90">0.001</span></p></td>
<td class="cl-cea4e071"><p class="cl-cea4d205"><span class="cl-cea37e90">0.1</span></p></td>
<td class="cl-cea4e072"><p class="cl-cea4d204"><span class="cl-cea37e90">102.15401</span></p></td>
<td class="cl-cea4e078"><p class="cl-cea4d205"><span class="cl-cea37e90">A_0_001_B_0_1</span></p></td>
<td class="cl-cea4e079"><p class="cl-cea4d204"><span class="cl-cea37e90">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-cea4e070"><p class="cl-cea4d204"><span class="cl-cea37e90">0.001</span></p></td>
<td class="cl-cea4e071"><p class="cl-cea4d205"><span class="cl-cea37e90">0.1</span></p></td>
<td class="cl-cea4e072"><p class="cl-cea4d204"><span class="cl-cea37e90">100.78589</span></p></td>
<td class="cl-cea4e078"><p class="cl-cea4d205"><span class="cl-cea37e90">A_0_001_B_0_1</span></p></td>
<td class="cl-cea4e079"><p class="cl-cea4d204"><span class="cl-cea37e90">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-cea4e070"><p class="cl-cea4d204"><span class="cl-cea37e90">0.001</span></p></td>
<td class="cl-cea4e071"><p class="cl-cea4d205"><span class="cl-cea37e90">0.1</span></p></td>
<td class="cl-cea4e072"><p class="cl-cea4d204"><span class="cl-cea37e90">91.14621</span></p></td>
<td class="cl-cea4e078"><p class="cl-cea4d205"><span class="cl-cea37e90">A_0_001_B_0_1</span></p></td>
<td class="cl-cea4e079"><p class="cl-cea4d204"><span class="cl-cea37e90">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-cea4e070"><p class="cl-cea4d204"><span class="cl-cea37e90">0.001</span></p></td>
<td class="cl-cea4e071"><p class="cl-cea4d205"><span class="cl-cea37e90">100</span></p></td>
<td class="cl-cea4e072"><p class="cl-cea4d204"><span class="cl-cea37e90">93.38012</span></p></td>
<td class="cl-cea4e078"><p class="cl-cea4d205"><span class="cl-cea37e90">A_0_001_B_100</span></p></td>
<td class="cl-cea4e079"><p class="cl-cea4d204"><span class="cl-cea37e90">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-cea4e070"><p class="cl-cea4d204"><span class="cl-cea37e90">0.001</span></p></td>
<td class="cl-cea4e071"><p class="cl-cea4d205"><span class="cl-cea37e90">100</span></p></td>
<td class="cl-cea4e072"><p class="cl-cea4d204"><span class="cl-cea37e90">91.03467</span></p></td>
<td class="cl-cea4e078"><p class="cl-cea4d205"><span class="cl-cea37e90">A_0_001_B_100</span></p></td>
<td class="cl-cea4e079"><p class="cl-cea4d204"><span class="cl-cea37e90">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-cea4e070"><p class="cl-cea4d204"><span class="cl-cea37e90">0.001</span></p></td>
<td class="cl-cea4e071"><p class="cl-cea4d205"><span class="cl-cea37e90">100</span></p></td>
<td class="cl-cea4e072"><p class="cl-cea4d204"><span class="cl-cea37e90">86.20118</span></p></td>
<td class="cl-cea4e078"><p class="cl-cea4d205"><span class="cl-cea37e90">A_0_001_B_100</span></p></td>
<td class="cl-cea4e079"><p class="cl-cea4d204"><span class="cl-cea37e90">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-cea4e070"><p class="cl-cea4d204"><span class="cl-cea37e90">0.001</span></p></td>
<td class="cl-cea4e071"><p class="cl-cea4d205"><span class="cl-cea37e90">500</span></p></td>
<td class="cl-cea4e072"><p class="cl-cea4d204"><span class="cl-cea37e90">51.76744</span></p></td>
<td class="cl-cea4e078"><p class="cl-cea4d205"><span class="cl-cea37e90">A_0_001_B_500</span></p></td>
<td class="cl-cea4e079"><p class="cl-cea4d204"><span class="cl-cea37e90">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-cea4e070"><p class="cl-cea4d204"><span class="cl-cea37e90">0.001</span></p></td>
<td class="cl-cea4e071"><p class="cl-cea4d205"><span class="cl-cea37e90">500</span></p></td>
<td class="cl-cea4e072"><p class="cl-cea4d204"><span class="cl-cea37e90">48.95016</span></p></td>
<td class="cl-cea4e078"><p class="cl-cea4d205"><span class="cl-cea37e90">A_0_001_B_500</span></p></td>
<td class="cl-cea4e079"><p class="cl-cea4d204"><span class="cl-cea37e90">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-cea4e070"><p class="cl-cea4d204"><span class="cl-cea37e90">0.001</span></p></td>
<td class="cl-cea4e071"><p class="cl-cea4d205"><span class="cl-cea37e90">500</span></p></td>
<td class="cl-cea4e072"><p class="cl-cea4d204"><span class="cl-cea37e90">52.68611</span></p></td>
<td class="cl-cea4e078"><p class="cl-cea4d205"><span class="cl-cea37e90">A_0_001_B_500</span></p></td>
<td class="cl-cea4e079"><p class="cl-cea4d204"><span class="cl-cea37e90">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-cea4e07a"><p class="cl-cea4d204"><span class="cl-cea37e90">0.001</span></p></td>
<td class="cl-cea4e082"><p class="cl-cea4d205"><span class="cl-cea37e90">1000</span></p></td>
<td class="cl-cea4e083"><p class="cl-cea4d204"><span class="cl-cea37e90">28.46122</span></p></td>
<td class="cl-cea4e084"><p class="cl-cea4d205"><span class="cl-cea37e90">A_0_001_B_1000</span></p></td>
<td class="cl-cea4e085"><p class="cl-cea4d204"><span class="cl-cea37e90">1</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>The <code>C_A0</code> and <code>C_B0</code> columns correspond to the
concentrations that elicit the <code>Effect</code>. The
<code>treat</code> column is a unique name for the combination of the
two drug concentrations. It has only letters numbers and underscores.
This is intentional so I can use this as a cohort name when Iâ€™m
constructing the estimation script below. The <code>samp_time</code>
column is set to 1. This is arbitrary because the mapping in the cohort
definitions requires a time column. Youâ€™ll see why it is arbitrary
below.</p>
</div>
<div class="section level2">
<h2 id="the-analysis-script-analysis_in_vitro-r">The analysis script: <code>analysis_in_vitro.R</code><a class="anchor" aria-label="anchor" href="#the-analysis-script-analysis_in_vitro-r"></a>
</h2>
<p>This analysis scripts has some aspects that are unique to the <em>in
vitro</em> analysis being performed.</p>
<div class="section level3">
<h3 id="output-times">Output times<a class="anchor" aria-label="anchor" href="#output-times"></a>
</h3>
<p>First is the output times. When you run simulations (which is what
happens when performing a parameter estimation) more output times
results in slower simulations. So it is important to only include the
ncesssary output times. In this case we only have two output times (0
and 1):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfg</span><span class="op">=</span><span class="fu"><a href="../reference/system_set_option.html">system_set_option</a></span><span class="op">(</span><span class="va">cfg</span>, group  <span class="op">=</span> <span class="st">"simulation"</span>, </span>
<span>                           option <span class="op">=</span> <span class="st">"output_times"</span>, </span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The final value of 1 was chosen because that corresponds to the time
column (<code>samp_time</code>) in the analysis dataset.</p>
</div>
<div class="section level3">
<h3 id="making-a-dynamic-simulation-static">Making a dynamic simulation static:<a class="anchor" aria-label="anchor" href="#making-a-dynamic-simulation-static"></a>
</h3>
<p>Next we set the <code>simulation</code> option <code>dynamic</code>
to <code>FALSE</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfg</span><span class="op">=</span><span class="fu"><a href="../reference/system_set_option.html">system_set_option</a></span><span class="op">(</span><span class="va">cfg</span>, group  <span class="op">=</span> <span class="st">"simulation"</span>, </span>
<span>                           option <span class="op">=</span> <span class="st">"dynamic"</span>, </span>
<span>                           value  <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>This will fix the values of the differential equations to 0 for the
purposes of the subsequent simulations. <strong>Only available in
ubiquity version <span class="math inline">\ge</span> 2.04.</strong></p>
</div>
<div class="section level3">
<h3 id="datasets">Datasets<a class="anchor" aria-label="anchor" href="#datasets"></a>
</h3>
<p>For the dataset we are reading it into a dataframe and loading it
that way. This was done so the dataset could be used internally with
ubiqiuty and also to construct the analysis below:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">er_data</span> <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"in_vitro_er_data.csv"</span><span class="op">)</span></span>
<span><span class="va">cfg</span> <span class="op">=</span> <span class="fu"><a href="../reference/system_load_data.html">system_load_data</a></span><span class="op">(</span><span class="va">cfg</span>, dsname     <span class="op">=</span> <span class="st">"er_data"</span>,</span>
<span>                            data_file  <span class="op">=</span> <span class="va">er_data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="defining-cohorts">Defining cohorts<a class="anchor" aria-label="anchor" href="#defining-cohorts"></a>
</h3>
<p>In the estimation tutorial cohorts are defined individually. We could
do that here too but it would be rather tedious. See we need a cohort
for every unique combination of <code>C_A0</code> and <code>C_B0</code>
in the dataset. To do this we are going to loop through each unique
value in the <code>treat</code> column and create a cohort. The variable
<code>tmp_treat</code> contains the value of the current treatment so
the first thing we do is get the records for the current treatment:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treat_recs</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">er_data</span>, <span class="va">treat</span> <span class="op">==</span> <span class="va">tmp_treat</span><span class="op">)</span></span></code></pre></div>
<p>This subset of the data is used to define the initial condition
parameters for the current cohort using the <code>cp</code> field (see
the help for <code><a href="../reference/system_define_cohort.html">system_define_cohort()</a></code> for more information
about this option). Because of the way the <code>treat</code> column was
constructed we can use this as the cohort name. This will allow us to
link the simulated output below to the original dataset in the post
processing section below. The inputs are set to <code>NULL</code> here
and we do not have to change them because there is no dosing.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohort</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    name         <span class="op">=</span> <span class="va">tmp_treat</span>,</span>
<span>    cf           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                     treat     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tmp_treat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    cp           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                     C_A0 <span class="op">=</span> <span class="va">treat_recs</span><span class="op">$</span><span class="va">C_A0</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                     C_B0 <span class="op">=</span> <span class="va">treat_recs</span><span class="op">$</span><span class="va">C_B0</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    inputs       <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    outputs      <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    dataset      <span class="op">=</span> <span class="st">"er_data"</span><span class="op">)</span></span></code></pre></div>
<p>Because we set the simulation option <code>dynamic</code> to
<code>FALSE</code>, the initial condition is set to the values for the
current treatment, and there are no inputs, then the system is
effectively behaving like an <em>in vitro</em> system.</p>
</div>
<div class="section level3">
<h3 id="postprocessing">Postprocessing<a class="anchor" aria-label="anchor" href="#postprocessing"></a>
</h3>
<p>You cannot rely on the normal figure generation and reporting
elements. In this example we can take the simulated output at the
estimation <code>erp</code> and the original data dataset
<code>er_data</code> to create meaningful diagnostic plots. This is
because we can link the two datasets using the <code>treat</code> column
from the original dataset to the <code>COHORT</code> column in
<code>erp$pred</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_orig</span> <span class="op">=</span> <span class="va">er_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">C_A0</span>, <span class="va">C_B0</span>, <span class="va">ave_eff</span>, <span class="va">treat</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_est</span> <span class="op">=</span> <span class="va">erp</span><span class="op">$</span><span class="va">pred</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">SMOOTH</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>treat <span class="op">=</span> <span class="va">COHORT</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_plot</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">df_est</span>, <span class="va">df_orig</span>, by<span class="op">=</span><span class="st">"treat"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>C_B0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">C_B0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">C_A0</span>, y<span class="op">=</span><span class="va">OBS</span>,  group<span class="op">=</span><span class="va">C_B0</span>, color<span class="op">=</span><span class="va">C_B0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">C_A0</span>, y<span class="op">=</span><span class="va">PRED</span>, group<span class="op">=</span><span class="va">C_B0</span>, color<span class="op">=</span><span class="va">C_B0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="contents-of-system-in_vitro-txt">Contents of <code>system-in_vitro.txt</code><a class="anchor" aria-label="anchor" href="#contents-of-system-in_vitro-txt"></a>
</h2>
<pre><code># Author: John Harrold &lt;john.m.harrold@gmail.com&gt;
#
# Analysis of an in vitro system. The system below was taken from:
#
# Chakraborty A, Jusko WJ. Pharmacodynamic interaction of recombinant human
# interleukin-10 and prednisolone using in vitro whole blood lymphocyte
# proliferation. J Pharm Sci. 2002 May;91(5):1334-42. doi: 10.1002/jps.3000.
# PMID: 11977109.
#

# #-------------#
# | Parameters  |
# #-------------#
#
# System parameters
#    name              value     lower      upper   units editable    grouping
#                                bound      bound
&lt;P&gt;  IC50_A              1.0       eps        Inf   -----      yes     Efficacy
&lt;P&gt;  IC50_B             50.0       eps        Inf   -----      yes     Efficacy
&lt;P&gt;  Imax_A              1.0       eps        Inf   -----      yes     Efficacy
&lt;P&gt;  Imax_B              1.0       eps        Inf   -----      yes     Efficacy
&lt;P&gt;  PSI                10.0       eps        Inf   -----      yes     Efficacy
&lt;P&gt;  G_A                 0.6       eps        Inf   -----      yes     Efficacy
&lt;P&gt;  G_B                 1.4       eps        Inf   -----      yes     Efficacy

&lt;P&gt;  Vp_A                1.0       eps        Inf   ml         yes     PK
&lt;P&gt;  CL_A                1.0       eps        Inf   ml/hr      yes     PK
&lt;P&gt;  Vp_B                1.0       eps        Inf   ml         yes     PK
&lt;P&gt;  CL_B                1.0       eps        Inf   ml/hr      yes     PK

&lt;P&gt;  C_A0                0.0       eps        Inf   -----      yes     IC
&lt;P&gt;  C_B0                0.0       eps        Inf   -----      yes     IC

# #-------------------#
# |Input Information |
# #-------------------#
#
# Bolus Events
# ------------
# times/events state   values    scale        units
&lt;B:times&gt;;              [  0  ];  1.0;        hours
&lt;B:events&gt;;      Cp_A;  [1.0  ];  1.0/Vp_A;   mg     
&lt;B:events&gt;;      Cp_B;  [1.0  ];  1.0/Vp_B;   mg     


# By default these values are zero but can be overwritten when 
# doing analysis of in vitro data.
&lt;I&gt; Cp_A = C_A0
&lt;I&gt; Cp_B = C_B0

&lt;As&gt; XI = IC50_A/IC50_B

&lt;Ad&gt; COMP_A    = SIMINT_POWER[Cp_A][G_A]/(SIMINT_POWER[PSI*IC50_A][G_A])
&lt;Ad&gt; COMP_B    = SIMINT_POWER[XI*Cp_B][G_B]/(SIMINT_POWER[PSI*IC50_A][G_B])
&lt;Ad&gt; COMP_Imax = Imax_A + Imax_B - Imax_A*Imax_B

&lt;Ad&gt; EFF_num    = Imax_A*COMP_A + Imax_B*COMP_B + COMP_Imax*COMP_A*COMP_B
&lt;Ad&gt; EFF_den    = COMP_A + COMP_B + COMP_A*COMP_B + 1.0
&lt;Ad&gt; EFF        = 100.0*(1.0-EFF_num/EFF_den)

# #-----------------------------#
# | ODEs, and State Information |
# #-----------------------------#

&lt;ODE:Cp_A&gt;  CL_A/Vp_A*Cp_A
&lt;ODE:Cp_B&gt;  CL_B/Vp_B*Cp_B

# #---------#
# | Outputs |
# #---------#
 
&lt;O&gt; Cp_A_mg_ml    = Cp_A
&lt;O&gt; Cp_B_mg_ml    = Cp_B
&lt;O&gt; Effect        = EFF

#&lt;VP&gt;  prop_err            1.0       eps        Inf   -----      yes     IC
#&lt;OE:Effect&gt; prop=prop_err

# #---------#
# | Options #
# #---------#
# specify different time scales
&lt;TS:hours&gt; 1.0</code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by John Harrold.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
