<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Howtos • ubiquity</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Howtos">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ubiquity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-chalkboard-teacher"></span> Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/Simulation.html">Individual and Population Simulations</a></li>
    <li><a class="dropdown-item" href="../articles/Language.html">ubiquity Modeling Language</a></li>
    <li><a class="dropdown-item" href="../articles/Estimation.html">Naive-Pooled Parameter Estimation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other Analysis Options</h6></li>
    <li><a class="dropdown-item" href="../articles/Deployment.html">Deploying Your Models in a Shiny App</a></li>
    <li><a class="dropdown-item" href="../articles/Titration.html">Trial/Rule-Based Simulations</a></li>
    <li><a class="dropdown-item" href="../articles/In_Vitro.html">Estimation of In Vitro/Static Systems</a></li>
    <li><a class="dropdown-item" href="../articles/NCA.html">Non-Compartmental Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Reporting.html">Integrated Word and PowerPoint Reporting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>More Help</h6></li>
    <li><a class="dropdown-item" href="../articles/Howto.html">Howtos</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-screencasts" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-video"></span> Screencasts</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-screencasts">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modeling</h6></li>
    <li><a class="external-link dropdown-item" href="https://vimeo.com/382859445">Individual and Population Simulations</a></li>
    <li><a class="external-link dropdown-item" href="https://vimeo.com/382860283">Model Deployment</a></li>
    <li><a class="external-link dropdown-item" href="https://vimeo.com/manage/videos/382829588">Naive-Pooled Parameter Estimation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other Tools</h6></li>
    <li><a class="external-link dropdown-item" href="https://vimeo.com/650643574">Tabula: Extracting Tabular Data from PDFs</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fas fa-hat-wizard"></span> Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fas fa-rss"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/john-harrold/ubiquity/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Howtos</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/john-harrold/ubiquity/blob/HEAD/vignettes/Howto.Rmd" class="external-link"><code>vignettes/Howto.Rmd</code></a></small>
      <div class="d-none name"><code>Howto.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="working-with-rxode2-nlmixr2-nonmem-and-monolix">Working with <code>rxode2</code>, <code>nlmixr2</code>, NONMEM, and
Monolix<a class="anchor" aria-label="anchor" href="#working-with-rxode2-nlmixr2-nonmem-and-monolix"></a>
</h2>
<p>Say you have a model in ubiquity and you want to use it with nlmixr2.
Or perhaps you want to try out the simulation engine of
<code>rxode2</code>, or you want to hand the model off to someone using
<code>Monolix</code>. This should provide you with a way to easily
convert your model into different formats in an automated fashion.</p>
<div class="section level3">
<h3 id="getting-your-model-in-rxode2-format">Getting your model in <code>rxode2</code> format<a class="anchor" aria-label="anchor" href="#getting-your-model-in-rxode2-format"></a>
</h3>
<p>As an example consider the system file for the two compartment model
(<code>system_2cmt.txt</code> below). When you build the system an
<code>rxode2</code> output target will be created. You can use the
<code><a href="../reference/system_fetch_template.html">system_fetch_template()</a></code> function to access this file. Below
I’m placing the script into the temporary directory. This is a script
that will generate an <code>rxode2</code> model function and store the
function in the object <code>my_model</code>. This is the default input
for <code>nlmixr2</code>. You can then use this function and the piping
methodology to do things like add IIV terms to parameters. So you can
use <code>ubiquity</code> to build your structural model and then
piping, <code>rxode2</code>, and <code>nlmixr2</code> for analysis.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfg</span> <span class="op">=</span> <span class="fu"><a href="../reference/build_system.html">build_system</a></span><span class="op">(</span>system_file         <span class="op">=</span> <span class="va">sf_2cmt_full</span>, </span>
<span>                   temporary_directory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"transient"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fr</span> <span class="op">=</span> <span class="fu"><a href="../reference/system_fetch_template.html">system_fetch_template</a></span><span class="op">(</span><span class="va">cfg</span>, </span>
<span>                           template         <span class="op">=</span> <span class="st">"nlmixr2"</span>, </span>
<span>                           output_directory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                           overwrite       <span class="op">=</span>  <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.github.io/rxode2/" class="external-link">rxode2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"system_nlmixr2.R"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>You can see the contents of <code>system_nlmixr2.R</code> and what
the <code>my_model</code> object looks like below. Note that to include
the output with <code>ubiquity</code> you will need to have some error
model. So along with the <code>&lt;O&gt;</code> Descriptor you will need
to define some variance parameters (<code>&lt;VP&gt;</code>) and also an
output error model (<code>&lt;OE:?&gt;</code>).</p>
</div>
<div class="section level3">
<h3 id="getting-your-model-in-nonmem-format">Getting your model in NONMEM format<a class="anchor" aria-label="anchor" href="#getting-your-model-in-nonmem-format"></a>
</h3>
<p>Once you have your model in <code>rxode2</code> format you can
convert it further into NONMEM format with the <code>babelmixr2</code>
package (via the <code>ruminate</code> package). To do this you need at
least one inter-individual variability term. You can do this in the
system file with the <code>&lt;IIV:?&gt;</code> delimiter. In this
example we will do that by using model piping. Here we specify that the
typical value of <code>Vc</code>, the parameter <code>TV_Vc</code>,
should have an error that is lognormally distributed. This will add the
IIV term <code>eta_Vc</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_model</span> <span class="op">=</span> <span class="va">my_model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="op">{</span><span class="va">Vc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">TV_Vc</span> <span class="op">+</span> <span class="va">eta_Vc</span><span class="op">)</span><span class="op">}</span><span class="op">)</span> </span></code></pre></div>
<p>Next we just need to load the <code>ruminate</code> package
(&gt;=0.2.4) and use the <code><a href="https://ruminate.ubiquity.tools/reference/rx2other.html" class="external-link">rx2other()</a></code> function to create a
NONMEM control stream:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ruminate.ubiquity.tools/" class="external-link">ruminate</a></span><span class="op">)</span></span>
<span><span class="va">my_model_nm</span> <span class="op">=</span> <span class="fu"><a href="https://ruminate.ubiquity.tools/reference/rx2other.html" class="external-link">rx2other</a></span><span class="op">(</span><span class="va">my_model</span>, out_type<span class="op">=</span><span class="st">"nonmem"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="getting-your-model-in-monolix-format">Getting your model in Monolix format<a class="anchor" aria-label="anchor" href="#getting-your-model-in-monolix-format"></a>
</h3>
<p>You can also get the model in Monolix by specifying
<code>monolix</code> as the output type:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_model_mlx</span> <span class="op">=</span> <span class="fu"><a href="https://ruminate.ubiquity.tools/reference/rx2other.html" class="external-link">rx2other</a></span><span class="op">(</span><span class="va">my_model</span>, out_type<span class="op">=</span><span class="st">"monolix"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h3>
<p>For more discussion on this topic see the following:</p>
<ul>
<li><a href="https://github.com/nlmixr2/babelmixr2/issues/107" class="external-link">https://github.com/nlmixr2/babelmixr2/issues/107</a></li>
</ul>
</div>
<div class="section level3 tabset">
<h3 class="tabset" id="models-in-different-formats">Models in different formats<a class="anchor" aria-label="anchor" href="#models-in-different-formats"></a>
</h3>






<ul class="nav nav-tabs" id="models-in-different-formats" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#model-equations" id="model-equations-tab" type="button" role="tab" aria-controls="model-equations" aria-selected="true" class="active nav-link">Model equations</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#ubiquity" id="ubiquity-tab" type="button" role="tab" aria-controls="ubiquity" aria-selected="false" class="nav-link"><code>ubiquity</code></button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#rxode2-script" id="rxode2-script-tab" type="button" role="tab" aria-controls="rxode2-script" aria-selected="false" class="nav-link"><code>rxode2</code> script</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#rxode2-object" id="rxode2-object-tab" type="button" role="tab" aria-controls="rxode2-object" aria-selected="false" class="nav-link"><code>rxode2</code> object</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#nonmem" id="nonmem-tab" type="button" role="tab" aria-controls="nonmem" aria-selected="false" class="nav-link">NONMEM</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#monolix" id="monolix-tab" type="button" role="tab" aria-controls="monolix" aria-selected="false" class="nav-link">Monolix</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="model-equations" role="tabpanel" aria-labelledby="model-equations-tab">

<p>The ODEs that define the system:</p>
<p><span class="math display">\begin{align*}
{Vc} &amp; = \exp\left({TV\_Vc}+{eta\_Vc}\right) \\
{Vt} &amp; = {TV\_Vt} \\
{CL} &amp; = {TV\_CL} \\
{Q} &amp; = {TV\_Q} \\
{ka} &amp; = {TV\_ka} \\
{fb} &amp; = {TV\_fb} \\
{Dinf} &amp; = {0} \\
\frac{d \: At}{dt} &amp; = \left(-{ka} {\times} {At}\right) \\
\frac{d \: Cc}{dt} &amp; = \left(\frac{{ka} {\times} {At} {\times}
{fb}}{{Vc}}-\frac{{CL}}{{Vc}} {\times} {Cc}-\frac{{Q} {\times}
\left({Cc}-{Cp}\right)}{{Vc}}+\frac{{Dinf}}{{Vc}}\right) \\
\frac{d \: Cp}{dt} &amp; = \left(\frac{+{Q} {\times}
\left({Cc}-{Cp}\right)}{{Vt}}\right) \\
{Cc\_mg\_ml} &amp; = {Cc} \\
{Cc\_mg\_ml} &amp; \sim prop({prop\_err})+add({add\_err})
\end{align*}</span></p>
</div>
<div class="tab-pane" id="ubiquity" role="tabpanel" aria-labelledby="ubiquity-tab">

<p>Contents of <code>system_2cmt.txt</code> file:</p>
<pre><code>
# Two compartment model with absorption compartment (At). The central
# compartment (Cc) had a volume (Vc), and the tissue compartment (Cp) has a
# volume (Vt). The system is parameterized in terms of macro constants (Q and
# CL)
#
# While the the default dosing is a 1 mg IV dose into the central compartment,
# the model is written to accept dosing into an absorption compartment and
# through continuous IV infusion.
#       _________ 
#      |         |
#      |   At    |
#      |         |
#      |_________|
#           |
#           | ka, fb
#           |
#           V
#       _________         _________  
#      |         |   Q   |         | 
#      |   Cc    |------&gt;|   Cp    |
#      |   Vc    |&lt;------|   Vt    |
#      |_________|       |_________|
#           |
#           | CL
#           |
#           V  
#
# System Units:
#                
#   mass          [=] mg 
#   volume        [=] ml
#   concentration [=] mg/ml
#   time          [=] hr


# #-------------#
# | Parameters  |
# #-------------#
#
# System parameters
#    name              value     lower      upper   units editable    grouping
#                                bound      bound

&lt;P&gt;  Vc                  1.0       eps        Inf   ml         yes     System
&lt;P&gt;  Vt                  1.0       eps        Inf   ml         yes     System
&lt;P&gt;  CL                  1.0       eps        Inf   ml/hr      yes     System
&lt;P&gt;  Q                   1.0       eps        Inf   ml/hr      yes     System
&lt;P&gt;  ka                  1.0       eps        Inf    1/hr      yes     System
&lt;P&gt;  fb                  1.0       eps        Inf   --         yes     System


# Bolus Events
# ------------
# times/events state   values        scale      units
&lt;B:times&gt;;             [  0  ];      1;          hours
&lt;B:events&gt;;      Cc;   [1.0  ];      1/Vc;       mg     
&lt;B:events&gt;;      At;   [0.0  ];      1;          mg     

# Infusion Rates 
# ------------
#  name     time/levels  values  scale    units
&lt;R:Dinf&gt;;     times;       [0];     1;    hours
&lt;R:Dinf&gt;;     levels;      [0];     1;    mg/hour

&lt;ODE:At&gt; -ka*At           
&lt;ODE:Cc&gt;  ka*At*fb/Vc - CL/Vc*Cc -Q*(Cc-Cp)/Vc  + Dinf/Vc
&lt;ODE:Cp&gt;                         +Q*(Cc-Cp)/Vt
 
&lt;O&gt; Cc_mg_ml    = Cc
&lt;VP&gt; prop_err   0.1            eps    inf      --     yes      Variance
&lt;VP&gt; add_err    0.1            eps    inf      ng/ml  yes      Variance
&lt;OE:Cc_mg_ml&gt; add=add_err; prop=prop_err

&lt;TS:hours&gt; 1.0
&lt;TS:days&gt;  1.0/24</code></pre>
</div>
<div class="tab-pane" id="rxode2-script" role="tabpanel" aria-labelledby="rxode2-script-tab">

<p>Contents of <code>system_nlmixr2.R</code> file produced by
<code><a href="../reference/system_fetch_template.html">system_fetch_template()</a></code>:</p>
<pre><code><span><span class="co">#</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#</span></span>
<span><span class="va">my_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/ini.html" class="external-link">ini</a></span><span class="op">(</span><span class="op">{</span></span>
<span>   <span class="co"># Typical Value of System Parameters </span></span>
<span>   <span class="va">TV_Vc</span>           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">1.0</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>   <span class="va">TV_Vt</span>           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">1.0</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>   <span class="va">TV_CL</span>           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">1.0</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>   <span class="va">TV_Q</span>            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">1.0</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>   <span class="va">TV_ka</span>           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">1.0</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>   <span class="va">TV_fb</span>           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">1.0</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span>   <span class="co"># Between-subject variability:</span></span>
<span>   </span>
<span>   <span class="co"># Error model parameters</span></span>
<span>   <span class="va">prop_err</span>     <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">0.1</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span></span>
<span>   <span class="va">add_err</span>      <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, <span class="fl">0.1</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="op">{</span> </span>
<span>   <span class="co"># System Parameters </span></span>
<span>   <span class="va">Vc</span>          <span class="op">=</span> <span class="va">TV_Vc</span></span>
<span>   <span class="va">Vt</span>          <span class="op">=</span> <span class="va">TV_Vt</span></span>
<span>   <span class="va">CL</span>          <span class="op">=</span> <span class="va">TV_CL</span></span>
<span>   <span class="va">Q</span>           <span class="op">=</span> <span class="va">TV_Q</span></span>
<span>   <span class="va">ka</span>          <span class="op">=</span> <span class="va">TV_ka</span></span>
<span>   <span class="va">fb</span>          <span class="op">=</span> <span class="va">TV_fb</span></span>
<span></span>
<span>   <span class="co"># Placeholders for infusion rates.</span></span>
<span>   <span class="co"># These should be defined in the dataset.</span></span>
<span>   <span class="co"># time scale: 1 units: (hours) </span></span>
<span>   <span class="co"># mass scale: 1 units: (mg/hour) </span></span>
<span>   <span class="va">Dinf</span>      <span class="op">=</span> <span class="fl">0.0</span></span>
<span></span>
<span>   <span class="co"># Defining ODEs</span></span>
<span>   <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">At</span><span class="op">)</span>    <span class="op">=</span> <span class="op">(</span><span class="op">-</span><span class="va">ka</span><span class="op">*</span><span class="va">At</span><span class="op">)</span></span>
<span>   <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">Cc</span><span class="op">)</span>    <span class="op">=</span> <span class="op">(</span><span class="va">ka</span><span class="op">*</span><span class="va">At</span><span class="op">*</span><span class="va">fb</span><span class="op">/</span><span class="va">Vc</span> <span class="op">-</span> <span class="va">CL</span><span class="op">/</span><span class="va">Vc</span><span class="op">*</span><span class="va">Cc</span> <span class="op">-</span><span class="va">Q</span><span class="op">*</span><span class="op">(</span><span class="va">Cc</span><span class="op">-</span><span class="va">Cp</span><span class="op">)</span><span class="op">/</span><span class="va">Vc</span>  <span class="op">+</span> <span class="va">Dinf</span><span class="op">/</span><span class="va">Vc</span><span class="op">)</span></span>
<span>   <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">Cp</span><span class="op">)</span>    <span class="op">=</span> <span class="op">(</span><span class="op">+</span><span class="va">Q</span><span class="op">*</span><span class="op">(</span><span class="va">Cc</span><span class="op">-</span><span class="va">Cp</span><span class="op">)</span><span class="op">/</span><span class="va">Vt</span><span class="op">)</span></span>
<span></span>
<span>   <span class="co"># Outputs and error models</span></span>
<span>   <span class="va">Cc_mg_ml</span>    <span class="op">=</span> <span class="va">Cc</span></span>
<span>   <span class="va">Cc_mg_ml</span> <span class="op">~</span> <span class="fu">prop</span><span class="op">(</span><span class="va">prop_err</span><span class="op">)</span> <span class="op">+</span> <span class="fu">add</span><span class="op">(</span><span class="va">add_err</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div class="tab-pane" id="rxode2-object" role="tabpanel" aria-labelledby="rxode2-object-tab">

<p>The <code>my_model</code> object:</p>
<pre><code>function () 
{
    ini({
        TV_Vc &lt;- c(2.22044604925031e-16, 1)
        TV_Vt &lt;- c(2.22044604925031e-16, 1)
        TV_CL &lt;- c(2.22044604925031e-16, 1)
        TV_Q &lt;- c(2.22044604925031e-16, 1)
        TV_ka &lt;- c(2.22044604925031e-16, 1)
        TV_fb &lt;- c(2.22044604925031e-16, 1)
        prop_err &lt;- c(2.22044604925031e-16, 0.1)
        add_err &lt;- c(2.22044604925031e-16, 0.1)
        eta_Vc ~ 1
    })
    model({
        Vc &lt;- exp(TV_Vc + eta_Vc)
        Vt = TV_Vt
        CL = TV_CL
        Q = TV_Q
        ka = TV_ka
        fb = TV_fb
        Dinf = 0
        d/dt(At) = (-ka * At)
        d/dt(Cc) = (ka * At * fb/Vc - CL/Vc * Cc - Q * (Cc - 
            Cp)/Vc + Dinf/Vc)
        d/dt(Cp) = (+Q * (Cc - Cp)/Vt)
        Cc_mg_ml = Cc
        Cc_mg_ml ~ prop(prop_err) + add(add_err)
    })
}
&lt;environment: 0x117d52550&gt;</code></pre>
</div>
<div class="tab-pane" id="nonmem" role="tabpanel" aria-labelledby="nonmem-tab">

<p>The file containing the control stream is found here:</p>
<p><code>my_model_nm$files$ctl$fn_full</code>.</p>
<pre><code>$PROBLEM  translated from babelmixr2
; comments show mu referenced model in ui$getSplitMuModel

$DATA my_model.csv IGNORE=@

$INPUT ID TIME EVID AMT DV CMT RXROW

$SUBROUTINES ADVAN13 TOL=6 ATOL=12 SSTOL=6 SSATOL=12

$MODEL NCOMPARTMENTS=3
     COMP(AT, DEFDOSE) ; At
     COMP(CC) ; Cc
     COMP(CP) ; Cp

$PK
  MU_1=THETA(1)
  VC=DEXP(MU_1+ETA(1)) ; Vc &lt;- exp(TV_Vc)
  VT=THETA(2) ; Vt &lt;- TV_Vt
  CL=THETA(3) ; CL &lt;- TV_CL
  RXR1=THETA(4) ; Q &lt;- TV_Q
  KA=THETA(5) ; ka &lt;- TV_ka
  FB=THETA(6) ; fb &lt;- TV_fb

$DES
  DINF=0 ; Dinf = 0
  DADT(1) = (- KA*A(1)) ; d/dt(At) = (-ka * At)
  DADT(2) = (KA*A(1)*FB/VC-CL/VC*A(2)-RXR1*(A(2)-A(3))/VC+DINF/VC) ; d/dt(Cc) = (ka * At * fb/Vc - CL/Vc * Cc - Q * (Cc - Cp)/Vc + Dinf/Vc)
  DADT(3) = (RXR1*(A(2)-A(3))/VT) ; d/dt(Cp) = (Q * (Cc - Cp)/Vt)
  CC_MG_ML=A(2) ; Cc_mg_ml = Cc

$ERROR
  ;Redefine LHS in $DES by prefixing with on RXE_ for $ERROR
  RXE_DINF=0 ; Dinf = 0
  RXE_CC_MG_ML=A(2) ; Cc_mg_ml = Cc
  RX_PF1=RXE_CC_MG_ML ; rx_pf1 ~ Cc_mg_ml
  ; Write out expressions for ipred and w
  RX_IP1 = RX_PF1
  RX_P1 = RX_IP1
  W1=DSQRT((THETA(8))**2+(RX_PF1)**2*(THETA(7))**2) ; W1 ~ sqrt((add_err)^2 + (rx_pred_f_)^2 * (prop_err)^2)
  IF (W1 .EQ. 0.0) W1 = 1
  IPRED = RX_IP1
  W     = W1
  Y     = IPRED + W*EPS(1)

$THETA (2.2204e-16, 1  ) ; 1 - TV_Vc   
       (2.2204e-16, 1  ) ; 2 - TV_Vt   
       (2.2204e-16, 1  ) ; 3 - TV_CL   
       (2.2204e-16, 1  ) ; 4 - TV_Q    
       (2.2204e-16, 1  ) ; 5 - TV_ka   
       (2.2204e-16, 1  ) ; 6 - TV_fb   
       (2.2204e-16, 0.1) ; 7 - prop_err
       (2.2204e-16, 0.1) ; 8 - add_err 

$OMEGA 1 ; eta_Vc

$SIGMA 1 FIX

$ESTIMATION METHOD=1 INTER MAXEVALS=100000 SIGDIG=3 SIGL=12 PRINT=1 NOABORT

$COVARIANCE

$TABLE ID ETAS(1:LAST) OBJI FIRSTONLY ONEHEADER NOPRINT
     FORMAT=s1PE17.9 NOAPPEND FILE=my_model.eta

$TABLE ID TIME IPRED PRED RXROW ONEHEADER NOPRINT
    FORMAT=s1PE17.9 NOAPPEND FILE=my_model.pred</code></pre>
</div>
<div class="tab-pane" id="monolix" role="tabpanel" aria-labelledby="monolix-tab">

<p>The file containing the mlxtran output is found here:</p>
<p><code>my_model_mlx$files$mlxtran$fn_full</code></p>
<pre><code>&lt;DATAFILE&gt;

[FILEINFO]
file='my_model-monolix.csv'
delimiter = comma
header = {ID, TIME, EVID, AMT, DV, ADM, nlmixrRowNums}

[CONTENT]
ID = {use=identifier}
TIME = {use=time}
EVID = {use=eventidentifier}
AMT = {use=amount}
DV = {use=observation, name=rx_prd_Cc_mg_ml, type=continuous}
ADM = {use=administration}

&lt;MODEL&gt;

[INDIVIDUAL]
input={Vc_pop, omega_Vc, Vt_pop, CL_pop, Q_pop, ka_pop, fb_pop}

DEFINITION:
Vc = {distribution=logNormal, typical=Vc_pop, sd=omega_Vc}
Vt = {distribution=normal, typical=Vt_pop, no-variability}
CL = {distribution=normal, typical=CL_pop, no-variability}
Q = {distribution=normal, typical=Q_pop, no-variability}
ka = {distribution=normal, typical=ka_pop, no-variability}
fb = {distribution=normal, typical=fb_pop, no-variability}

[LONGITUDINAL]
input={add_err, prop_err}
file='my_model-monolix.txt'

DEFINITION:
rx_prd_Cc_mg_ml={distribution = normal, prediction = rx_pred_Cc_mg_ml, errorModel=combined2(add_err,prop_err)}

&lt;FIT&gt;
data={rx_prd_Cc_mg_ml}
model={rx_prd_Cc_mg_ml}

&lt;PARAMETER&gt;
Vc_pop={value=2.71828182845905, method=MLE}
Vt_pop={value=1, method=MLE}
CL_pop={value=1, method=MLE}
Q_pop={value=1, method=MLE}
ka_pop={value=1, method=MLE}
fb_pop={value=1, method=MLE}
prop_err={value=0.1, method=MLE}
add_err={value=0.1, method=MLE}
omega_Vc={value=1, method=MLE}

&lt;MONOLIX&gt;

[TASKS]
populationParameters()
individualParameters(method = {conditionalMode})
fim(method = StochasticApproximation)
logLikelihood(method = ImportanceSampling)
plotResult(method = {outputplot, indfits, obspred, residualsscatter, residualsdistribution, parameterdistribution, covariatemodeldiagnosis, randomeffects, covariancemodeldiagnosis, saemresults})

[SETTINGS]
GLOBAL:
exportpath = 'my_model-monolix'
POPULATION:
exploratoryautostop = no
smoothingautostop = no
burniniterations = 5
exploratoryiterations = 250
simulatedannealingiterations = 250
smoothingiterations = 200
exploratoryalpha = 0
exploratoryinterval = 200
omegatau = 0.95
errormodeltau = 0.95</code></pre>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by John Harrold.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
