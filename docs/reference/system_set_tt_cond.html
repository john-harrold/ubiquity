<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Once a rule has been defined using
system_new_tt_rule, it can then be used by specifying checks at
each of the titration time points that, when true, will perform some actions."><title>Define Titration Triggers and Actions — system_set_tt_cond • ubiquity</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Define Titration Triggers and Actions — system_set_tt_cond"><meta property="og:description" content="Once a rule has been defined using
system_new_tt_rule, it can then be used by specifying checks at
each of the titration time points that, when true, will perform some actions."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ubiquity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--tutorials">
    <span class="fas fa fas fa-chalkboard-teacher"></span>
     
    Tutorials
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--tutorials">
    <h6 class="dropdown-header" data-toc-skip>Getting Started</h6>
    <a class="dropdown-item" href="../articles/Simulation.html">Individual and Population Simulations</a>
    <a class="dropdown-item" href="../articles/Language.html">ubiquity Modeling Language</a>
    <a class="dropdown-item" href="../articles/Estimation.html">Naive-Pooled Parameter Estimation</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Other Analysis Options</h6>
    <a class="dropdown-item" href="../articles/Deployment.html">Deploying Your Models in a Shiny App</a>
    <a class="dropdown-item" href="../articles/Titration.html">Trial/Rule-Based Simulations</a>
    <a class="dropdown-item" href="../articles/NCA.html">Non-Compartmental Analysis</a>
    <a class="dropdown-item" href="../articles/Reporting.html">Integrated Word and PowerPoint Reporting</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--screencasts">
    <span class="fas fa fas fa-video"></span>
     
    Screencasts
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--screencasts">
    <h6 class="dropdown-header" data-toc-skip>Modeling</h6>
    <a class="external-link dropdown-item" href="https://vimeo.com/382859445">Individual and Population Simulations</a>
    <a class="external-link dropdown-item" href="https://vimeo.com/382860283">Model Deployment</a>
    <a class="external-link dropdown-item" href="https://vimeo.com/manage/videos/382829588">Naive-Pooled Parameter Estimation</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Other Tools</h6>
    <a class="external-link dropdown-item" href="https://vimeo.com/650643574">Tabula: Extracting Tabular Data from PDFs</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fas fa fas fa-hat-wizard"></span>
     
    Functions
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">
    <span class="fas fa fas fa-rss"></span>
     
    News
  </a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/john-harrold/ubiquity/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Define Titration Triggers and Actions</h1>
      <small class="dont-index">Source: <a href="https://github.com/john-harrold/ubiquity/blob/HEAD/R/ubiquity.R" class="external-link"><code>R/ubiquity.R</code></a></small>
      <div class="d-none name"><code>system_set_tt_cond.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Once a rule has been defined using
<code><a href="system_new_tt_rule.html">system_new_tt_rule</a></code>, it can then be used by specifying checks at
each of the titration time points that, when true, will perform some actions.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">system_set_tt_cond</span><span class="op">(</span><span class="va">cfg</span>, <span class="va">name</span>, <span class="va">cond</span>, <span class="va">action</span>, value <span class="op">=</span> <span class="st">"-1"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>cfg</dt>
<dd><p>ubiquity system object</p></dd>


<dt>name</dt>
<dd><p>string containing the name for the titration rule to which this condition applies</p></dd>


<dt>cond</dt>
<dd><p>string that evaluates a boolean value that is <code>TRUE</code> when the action should be triggered</p></dd>


<dt>action</dt>
<dd><p>stringing that evaluates to what should be done when the condition is met (e.g. changing the dose, state change, etc)</p></dd>


<dt>value</dt>
<dd><p>code to be stored in the titration history to track when this condition has been triggered</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Ubiquity system object with the titration condition defined</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The general syntax for setting a new condition is:</p>
<div class="sourceCode"><pre><code><span></span>
<span><span class="va">cfg</span> <span class="op">=</span> <span class="fu">system_new_tt_cond</span><span class="op">(</span><span class="va">cfg</span>,</span>
<span>                        name   <span class="op">=</span> <span class="st">"rname"</span>,</span>
<span>                        cond   <span class="op">=</span> <span class="st">"BOOLEAN EXPRESSION"</span>,</span>
<span>                        action <span class="op">=</span> <span class="st">"EXPRESSION"</span>,</span>
<span>                        value  <span class="op">=</span> <span class="st">"VALUE"</span><span class="op">)</span></span></code></pre></div>

<p>The <code>name</code>
input will associate this condition with a previously defined rule. For each
time defined when the rule was created, the condition (<code>cond</code>) will be
evaluated. If that condition evaluates as <code>TRUE</code> then the <code>action</code> will be
evaluated. Lastly, when a condition action is evaluated, the <code>value</code> is stored
in the titration history.</p>
<p>Multiple conditions can be associated with a rule. The internal titration
history will track each one where a condition has been evaluated as true, but
the simulation output will only show the <b>last</b> condition to be evaluated as
true.</p>
<p>The <code>cond</code> field is a string that, when evaluated, will produce a boolean value
(<code>TRUE</code> or <code>FALSE</code>). If you simply want to force an action at each of the times
for a given rule you can use: <code>cond = "TRUE"</code>. Alternatively you can provide
mathematical expressions or even complicated user defined functions.</p>
<p>The <code>action</code> field is evaluated when <code>cond</code> is true. To modify how a simulation
is going to be performed, you will want to modify the <code>SIMINT_cfgtt</code>
variable using the different system commands. Certain common tasks have
prototype functions created to make it easier for the user:</p><ul><li><p><code>SI_TT_BOLUS</code> - Set bolus dosing</p></li>
<li><p><code>SI_TT_RATE</code> - Set infusion inputs</p></li>
<li><p><code>SI_TT_STATE</code> - Reset system states</p></li>
</ul><p><b>Note:</b> Protype functions are strings but sometimes it is necessary to
specify strings within this string. For the main string use double quotes (")
and for the internal strings use single quotes (')</p>
<p><b><code>SI_TT_BOLUS</code></b></p>
<p>The simplest way to apply a bolus when the condition is true is to use the following:</p>
<div class="sourceCode"><pre><code><span></span>
<span><span class="va">action</span> <span class="op">=</span> <span class="st">"SI_TT_BOLUS[state=’At’, </span></span>
<span><span class="st">                     values=c(10, 10, 10), </span></span>
<span><span class="st">                     times=c(0, 1, 2)]"</span></span></code></pre></div>

<p>The <code>values</code> and <code>times</code> are vectors of numbers of equal length. The dosing and
time units are those specified in the <code>system.txt</code> file for the <code>&lt;B:?&gt;</code> delimiter. The
times are relative to the titration time. So <code>0</code> above means at the titration time.</p>
<p>It’s possible to specify an interval and a number of times to repeat the last dose
using the following:</p>
<div class="sourceCode"><pre><code><span></span>
<span><span class="va">action</span> <span class="op">=</span> <span class="st">"SI_TT_BOLUS[state    = ’At’, </span></span>
<span><span class="st">                     values   = c(5, 5, 10), </span></span>
<span><span class="st">                     times    = c(0, 2, 4), </span></span>
<span><span class="st">                     repdose  = ’last’, </span></span>
<span><span class="st">                     number   = 7, </span></span>
<span><span class="st">                     interval = 4]"</span></span></code></pre></div>

<p>This will give a dose of <code>5</code> at the titration point and <code>2</code> time units later. The dose of <code>10</code>
at time <code>4</code> will be repeated <code>7</code> times every <code>4</code> time units. So a total of 8 (<code>7 + 1</code>) doses
at <code>10</code> will be administered. Remember the time units were those defined in <code>&lt;B:?&gt;</code>.
The input <code>repdose</code> can be either <code>’last’</code> or <code>’none’</code>.</p>
<p><b>Note:</b> The main string is in double quotes <code>" "</code> but the strings in the protype
argument (e.g. <code>’last’</code>) are in single quotes <code>’ ’</code>.</p>
<p><b><code>SI_TT_RATE</code></b></p>
<p>If you created an infusion named <code>Dinf</code> using <code>&lt;R:?&gt;</code> and the infusion units
are min (times) and mg/min (rates). To have a 60 minute infusion of 20
mg/min then we would do the following:</p>
<div class="sourceCode"><pre><code><span></span>
<span><span class="va">action</span> <span class="op">=</span> <span class="st">"SI_TT_RATE[rate=’Dinf’, times=c(0, 60), levels=c(20.0, 0)]"</span></span></code></pre></div>

<p>If we wanted to do this every day for 9 more days (a total of 10 days) we can repeat
the sequence:</p>
<div class="sourceCode"><pre><code><span></span>
<span><span class="va">action</span> <span class="op">=</span> <span class="st">"SI_TT_RATE[rate     = ’Dinf’, </span></span>
<span><span class="st">                    times    = c(0, 60), </span></span>
<span><span class="st">                    levels   = c(20, 0), </span></span>
<span><span class="st">                    repdose  = ’sequence’, </span></span>
<span><span class="st">                    number   = 9, </span></span>
<span><span class="st">                    interval = 24*60]"</span></span></code></pre></div>

<p>The input <code>repdose</code> can be either <code>’sequence’</code> or <code>’none’</code>.</p>
<p><b>Note:</b> The time units and dosing rate are those specified using <code>&lt;R:?&gt;</code>.</p>
<p><b><code>SI_TT_STATE</code></b></p>
<p>To provide fine control over states at titration points the state reset
prototype is provided. For example, if you are modeling an assay where
there is a wash step and you want to drop a concentration to zero. If you
have a state named <code>Cc</code> defined in your <code>system.txt</code> and you want to set
it to <code>0.0</code> in a condition the following action would work.</p>
<div class="sourceCode"><pre><code><span></span>
<span><span class="va">action</span> <span class="op">=</span> <span class="st">"SI_TT_STATE[Cc][0.0]"</span></span></code></pre></div>

<p>The value here is a number but you can use any mathematical
combination of variables available in the titration environment. Also you
can create your own user function and place the function call within the
brackets above.</p>
<p><b>Titration Environment</b></p>
<p>The <code>cond</code>, <code>action</code>, and <code>value</code> statements can use any variables available in
the titration environment. If you want to perform complicated actions, you can
simply create a user defined functions and pass it the variables from the
titration environment that you need. These include named variables from the
model as well as internal variables used to control the titration.</p>
<p><b>States and Parameters</b></p>
<p>System parameters (<code>&lt;P&gt;</code>), static secondary parameters (<code>&lt;As&gt;</code>) and 
the initial value of covariates are available. Also the state values 
(at the current titration time) can be used. These are all available as 
the names specified in the <code>system.txt</code> file. Since system resets
(<code>SI_TT_STATE</code>) are processed first, any changes made to states are 
the values that are active for other actions.</p>
<p><b>Internal Simulation Variables</b></p>
<p>Internal variables are used to control titration activities. These variables can also be used in the conditions and actions.</p>
<ul><li><p><code>SIMINT_p</code> - list of system parameters</p></li>
<li><p><code>SIMINT_cfg</code> - system configuration sent into the titration routine</p></li>
<li><p><code>SIMINT_cfgtt</code>- system configuration at the current titration event time</p></li>
<li><p><code>SIMINT_ttimes</code> - vector of titration times (in simulation units)</p></li>
<li><p><code>SIMINT_ttime</code> - current titration time  (in simulation units)</p></li>
<li><p><code>SIMINT_tt_ts</code> - list of time scales for the current titration</p></li>
<li><p><code>SIMINT_history</code> - data frame tracking the history of conditions that evaluated true with the following structure:</p></li>
<li><p></p><ul><li><p><code>tname</code> - name of titration rule</p></li>
<li><p><code>value</code> - value indicating condition that was satisfied</p></li>
<li><p><code>simtime</code> - simulation time when that rule/value were triggered</p></li>
<li><p><code>timescale</code> -  time at the rule timescale when that rule/value were triggered</p></li>
</ul></li>
</ul><p><b>Individual Simulations</b></p>
<p>To run an individual titration simulation use the following:</p>
<div class="sourceCode"><pre><code><span></span>
<span><span class="va">som</span> <span class="op">=</span> <span class="fu"><a href="../reference/run_simulation_titrate.html">run_simulation_titrate</a></span><span class="op">(</span><span class="va">parameters</span>, <span class="va">cfg</span><span class="op">)</span></span></code></pre></div>

<p>This provides the same output as <code><a href="run_simulation_ubiquity.html">run_simulation_ubiquity</a></code> with
 two extra fields. The first, <code>som$titration</code>, contains three columns for each
 titration rule. The columns will have a length equal and corresponding to the
 simulation times. If the rule name is rname, then the column headers will have
 the following names and meanings:</p><ul><li><p><code>tt.rname.value</code> - Value of the rule for the active condition or -1 if not triggered</p></li>
<li><p><code>tt.rname.simtime</code> - Simulation time where the last condition became active</p></li>
<li><p><code>tt.rname.timescale</code> - Simulation time in the time scale the rule was specified in</p></li>
</ul><p>The second field is <code>som$titration_history</code> which contains a summary list of all of the titration events that were triggered.</p><ul><li><p><code>tname</code> - Titration rule name</p></li>
<li><p><code>value</code> - Value of the rule for the active condition or -1 if not triggered</p></li>
<li><p><code>simtime</code> - Simulation time where the last condition became active</p></li>
<li><p><code>timescale</code> - Simulation time in the time scale the rule was specified in</p></li>
</ul><p>To convert this structured list into a data frame the <code><a href="som_to_df.html">som_to_df</a></code> command can be used:</p>
<div class="sourceCode"><pre><code><span></span>
<span><span class="va">sdf</span> <span class="op">=</span> <span class="fu"><a href="../reference/som_to_df.html">som_to_df</a></span><span class="op">(</span><span class="va">cfg</span>, <span class="va">som</span><span class="op">)</span></span></code></pre></div>

<p>To run stochastic titration simulations, the same function is used:</p>
<div class="sourceCode"><pre><code><span></span>
<span><span class="va">som</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_subjects.html">simulate_subjects</a></span><span class="op">(</span><span class="va">parameters</span>, <span class="va">cfg</span><span class="op">)</span></span></code></pre></div>

<p>This will add a data a list element called <code>som$titration</code> with three
fields for each titration rule:</p>
<ul><li><p><code>tt.rname.value</code> - Value of the rule for the active condition or -1 if not triggered</p></li>
<li><p><code>tt.rname.simtime</code> - Simulation time where the last condition became active</p></li>
<li><p><code>tt.rname.timescale</code> - Simulation time in the time scale the rule was specified in</p></li>
</ul><p>Each of these fields is a matrix with an entry for each simulation time
(column) and each subject (row). This data structure can also be converted to
a data frame using <code>som_to_df</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="system_new_tt_rule.html">system_new_tt_rule</a></code>, <code><a href="run_simulation_titrate.html">run_simulation_titrate</a></code>,  <code><a href="som_to_df.html">som_to_df</a></code>, <code><a href="simulate_subjects.html">simulate_subjects</a></code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by John Harrold.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

