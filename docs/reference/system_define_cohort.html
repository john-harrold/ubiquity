<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Define Estimation Cohort — system_define_cohort • ubiquity</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet"><script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Define Estimation Cohort — system_define_cohort"><meta name="description" content="Define a cohort to include in a parameter estimation"><meta property="og:description" content="Define a cohort to include in a parameter estimation"><meta property="og:image" content="https://r.ubiquity.tools/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ubiquity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-chalkboard-teacher"></span> Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/Simulation.html">Individual and Population Simulations</a></li>
    <li><a class="dropdown-item" href="../articles/Language.html">ubiquity Modeling Language</a></li>
    <li><a class="dropdown-item" href="../articles/Estimation.html">Naive-Pooled Parameter Estimation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other Analysis Options</h6></li>
    <li><a class="dropdown-item" href="../articles/Deployment.html">Deploying Your Models in a Shiny App</a></li>
    <li><a class="dropdown-item" href="../articles/Titration.html">Trial/Rule-Based Simulations</a></li>
    <li><a class="dropdown-item" href="../articles/In_Vitro.html">Estimation of In Vitro/Static Systems</a></li>
    <li><a class="dropdown-item" href="../articles/NCA.html">Non-Compartmental Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Reporting.html">Integrated Word and PowerPoint Reporting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>More Help</h6></li>
    <li><a class="dropdown-item" href="../articles/Howto.html">Howtos</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-screencasts" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-video"></span> Screencasts</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-screencasts"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modeling</h6></li>
    <li><a class="external-link dropdown-item" href="https://vimeo.com/382859445">Individual and Population Simulations</a></li>
    <li><a class="external-link dropdown-item" href="https://vimeo.com/382860283">Model Deployment</a></li>
    <li><a class="external-link dropdown-item" href="https://vimeo.com/manage/videos/382829588">Naive-Pooled Parameter Estimation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other Tools</h6></li>
    <li><a class="external-link dropdown-item" href="https://vimeo.com/650643574">Tabula: Extracting Tabular Data from PDFs</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fas fa-hat-wizard"></span> Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fas fa-rss"></span> News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/john-harrold/ubiquity/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Define Estimation Cohort</h1>
      <small class="dont-index">Source: <a href="https://github.com/john-harrold/ubiquity/blob/HEAD/R/ubiquity.R" class="external-link"><code>R/ubiquity.R</code></a></small>
      <div class="d-none name"><code>system_define_cohort.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Define a cohort to include in a parameter estimation</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">system_define_cohort</span><span class="op">(</span><span class="va">cfg</span>, <span class="va">cohort</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-cfg">cfg<a class="anchor" aria-label="anchor" href="#arg-cfg"></a></dt>
<dd><p>ubiquity system object</p></dd>


<dt id="arg-cohort">cohort<a class="anchor" aria-label="anchor" href="#arg-cohort"></a></dt>
<dd><p>list with cohort information</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>ubiquity system object with cohort defined</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Each cohort has a name (eg <code>d5mpk</code>), and the dataset containing the
information for this cohort is identified (the name defined in <code><a href="system_load_data.html">system_load_data</a></code>)</p>
<div class="sourceCode"><pre><code><span><span class="va">cohort</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name         <span class="op">=</span> <span class="st">"d5mpk"</span>,</span>
<span>  dataset      <span class="op">=</span> <span class="st">"pm_data"</span>,</span>
<span>  inputs       <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outputs      <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>

<p>Next if only a portion of the dataset applies to the current cohort, you
can define a filter (<code>cf</code> field). This will be
applied to the dataset to only return values relevant to this cohort. For
example, if we only want records where the column <code>DOSE</code> is 5 (for the 5
mpk cohort). We can use the following:</p>
<div class="sourceCode"><pre><code><span><span class="va">cohort</span><span class="op">[[</span><span class="st">"cf"</span><span class="op">]</span><span class="op">]</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>DOSE   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

<p>If the dataset has the headings <code>ID</code>, <code>DOSE</code> and <code>SEX</code>  and
cohort filter had the following format:</p>
<div class="sourceCode"><pre><code><span><span class="va">cohort</span><span class="op">[[</span><span class="st">"cf"</span><span class="op">]</span><span class="op">]</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ID    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>                        DOSE  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span>,</span>
<span>                        SEX   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

<p>It would be translated into the boolean filter:</p>
<div class="sourceCode"><pre><code>(ID==1) | (ID==2) | (ID==3) | (ID==4)) &amp; ((DOSE == 5) | (DOSE==10)) &amp; (SEX == 1)</code></pre></div>

<p>Optionally you may want to fix a system parameter to a different value for a
given cohort. This can be done using the cohort parameter (<code>cp</code>) field.
For example if you had the body weight defined as a system parameter
(<code>BW</code>), and you wanted to fix the body weight to 70 for the current
cohort you would do the following:</p>
<div class="sourceCode"><pre><code><span><span class="va">cohort</span><span class="op">[[</span><span class="st">"cp"</span><span class="op">]</span><span class="op">]</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>BW        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">70</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

<p>Note that you can only fix parameters that are not being estimated.</p>
<p>By default the underlying simulation output times will be taken from the
general output_times option (see <code><a href="system_set_option.html">system_set_option</a></code>). However It may also be
necessary to specify simulation output times for a specific cohort. The
<code>output_times</code> field can be used for this. Simply provide a vector of
 output times:</p>
<div class="sourceCode"><pre><code><span><span class="va">cohort</span><span class="op">[[</span><span class="st">"output_times"</span><span class="op">]</span><span class="op">]</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span>,<span class="fl">2</span><span class="op">)</span></span></code></pre></div>

<p>Next we define the dosing for this cohort. It is only necessary to define
those inputs that are non-zero. So if the data here were generated from
animals given a single 5 mpk IV at time 0. Bolus dosing is defined
using <code>&lt;B:times&gt;</code> and <code>&lt;B:events&gt;</code>. If <code>Cp</code> is the central
compartment, you would pass this information to the cohort in the
following manner:</p>
<div class="sourceCode"><pre><code><span><span class="va">cohort</span><span class="op">[[</span><span class="st">"inputs"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"bolus"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cohort</span><span class="op">[[</span><span class="st">"inputs"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"bolus"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"Cp"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>TIME<span class="op">=</span><span class="cn">NULL</span>, AMT<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">cohort</span><span class="op">[[</span><span class="st">"inputs"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"bolus"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"Cp"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"TIME"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">cohort</span><span class="op">[[</span><span class="st">"inputs"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"bolus"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"Cp"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"AMT"</span><span class="op">]</span><span class="op">]</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>

<p>Inputs can also include any infusion rates (<code>infusion_rates</code>) or
covariates (<code>covariates</code>). Covariates will have the default value
specified in the system file unless overwritten here. The units here are
the same as those in the system file</p>
<p>Next we need to map the outputs in the model to the observation data in the
dataset. Under the <code>outputs</code> field there is a field for each output. Here
the field <code>ONAME</code> can be replaced with something more useful (like
<code>PK</code>).</p>
<div class="sourceCode"><pre><code><span><span class="va">cohort</span><span class="op">[[</span><span class="st">"outputs"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"ONAME"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>

<p>If you want to further filter the dataset. Say for example you
have two outputs and the <code>cf</code> applied above reduces your dataset
down to both outputs. Here you can use the  "of" field to apply an "output filter"
to further filter the records down to those that apply to the current output ONAME.</p><div class="sourceCode"><pre><code><span><span class="va">cohort</span><span class="op">[[</span><span class="st">"outputs"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"ONAME"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"of"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>       COLNAME          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>       COLNAME          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><p>If you do not need further filtering of data, you can you can just omit the field.</p>
<p>Next you need to identify the columns in the dataset that contain your
times and observations. This is found in the <code>obs</code> field for the
current observation:</p><div class="sourceCode"><pre><code><span><span class="va">cohort</span><span class="op">[[</span><span class="st">"outputs"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"ONAME"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"obs"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>         time           <span class="op">=</span> <span class="st">"TIMECOL"</span>,</span>
<span>         value          <span class="op">=</span> <span class="st">"OBSCOL"</span>,</span>
<span>         missing        <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>

<p>The times and observations in the dataset are found in the <code>’TIMECOL’</code> column
and the <code>’OBSCOL’</code> column (optional missing data option specified by -1).</p>
<p>These observations in the dataset need to be mapped to the appropriate
elements of your model defined in the system file. This is done with the
<code>model</code> field:</p>
<div class="sourceCode"><pre><code><span><span class="va">cohort</span><span class="op">[[</span><span class="st">"outputs"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"ONAME"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"model"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>         time           <span class="op">=</span> <span class="st">"TS"</span>,</span>
<span>         value          <span class="op">=</span> <span class="st">"MODOUTPUT"</span>,</span>
<span>         variance       <span class="op">=</span> <span class="st">"PRED^2"</span><span class="op">)</span></span></code></pre></div>

<p>First the system time scale indicated by the <code>TS</code> placeholder above
must be specfied. The time scale must correspond to the data found in
<code>TIMECOL</code> above.  Next the model output indicated by the <code>MODOUTPUT</code>
placeholder needs to be specified. This is defined in the system file using
<code>&lt;O&gt;</code> and should correspond to <code>OBSCOL</code> from the dataset. Lastly the
<code>variance</code> field specifies the variance model. You can use the keyword
<code>PRED</code> (the model predicted output) and any variance parameters. Some
examples include:</p>
<ul><li><p><code>variance = "1"</code> - Least squares</p></li>
<li><p><code>variance = "PRED^2"</code> -  Weighted least squares proportional to the prediction squared</p></li>
<li><p><code>variance = "(SLOPE*PRED)^2"</code>  Maximum likelihood estimation where <code>SLOPE</code> is defined as a variance parameter (<code>&lt;VP&gt;</code>)</p></li>
</ul><p>The following controls the plotting aspects associated with this output. The
color, shape and line values are the values used by ggplot functions.</p>
<div class="sourceCode"><pre><code><span><span class="va">cohort</span><span class="op">[[</span><span class="st">"outputs"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"ONAME"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"options"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        marker_color   <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        marker_shape   <span class="op">=</span> <span class="fl">16</span>,</span>
<span>        marker_line    <span class="op">=</span> <span class="fl">1</span> <span class="op">)</span></span></code></pre></div>

<p>If the cohort has multiple outputs, simply repeat the process above for the.
additional cohorts. The estimation vignettes contains examples of this.</p>
<p><b>Note: Output names should be consistent between cohorts so they will be grouped together when plotting results.</b></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Estimation vignette (<code><a href="../articles/Estimation.html">vignette("Estimation", package = "ubiquity")</a></code>)</p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by John Harrold.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

