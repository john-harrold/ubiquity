<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Define Estimation Cohort — system_define_cohort • ubiquity</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Define Estimation Cohort — system_define_cohort" />
<meta property="og:description" content="Define a cohort to include in a parameter estimation" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ubiquity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-chalkboard-teacher"></span>
     
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="divider"></li>
    <li class="dropdown-header">Getting Started</li>
    <li>
      <a href="../articles/Simulation.html">Individual and Population Simulations</a>
    </li>
    <li>
      <a href="../articles/Language.html">ubiquity Modeling Language</a>
    </li>
    <li>
      <a href="../articles/Estimation.html">Naive-Pooled Parameter Estimation</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Other Analysis Options</li>
    <li>
      <a href="../articles/Deployment.html">Deploying Your Models in a Shiny App</a>
    </li>
    <li>
      <a href="../articles/Titration.html">Trial/Rule-Based Simulations</a>
    </li>
    <li>
      <a href="../articles/NCA.html">Non-Compartmental Analysis</a>
    </li>
    <li>
      <a href="../articles/Reporting.html">Integrated Word and PowerPoint Reporting</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-video"></span>
     
    Screencasts
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="divider"></li>
    <li class="dropdown-header">Modeling</li>
    <li>
      <a href="https://vimeo.com/382859445">Individual and Population Simulations</a>
    </li>
    <li>
      <a href="https://vimeo.com/382860283">Model Deployment</a>
    </li>
    <li>
      <a href="https://vimeo.com/manage/videos/382829588">Naive-Pooled Parameter Estimation</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Other Tools</li>
    <li>
      <a href="https://vimeo.com/650643574">Tabula: Extracting Tabular Data from PDFs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa-hat-wizard"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fas fa-rss"></span>
     
    News
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/john-harrold/ubiquity/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Define Estimation Cohort</h1>
    <small class="dont-index">Source: <a href='https://github.com/john-harrold/ubiquity/blob/master/R/ubiquity.R'><code>R/ubiquity.R</code></a></small>
    <div class="hidden name"><code>system_define_cohort.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Define a cohort to include in a parameter estimation</p>
    </div>

    <pre class="usage"><span class='fu'>system_define_cohort</span><span class='op'>(</span><span class='va'>cfg</span>, <span class='va'>cohort</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>cfg</th>
      <td><p>ubiquity system object</p></td>
    </tr>
    <tr>
      <th>cohort</th>
      <td><p>list with cohort information</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>ubiquity system object with cohort defined</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Each cohort has a name (eg <code>d5mpk</code>), and the dataset containing the
information for this cohort is identified (the name defined in <code><a href='system_load_data.html'>system_load_data</a></code>)</p>
<pre><span class='va'>cohort</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
  name         <span class='op'>=</span> <span class='st'>"d5mpk"</span>,
  dataset      <span class='op'>=</span> <span class='st'>"pm_data"</span>,
  inputs       <span class='op'>=</span> <span class='cn'>NULL</span>,
  outputs      <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span></pre>

<p>Next if only a portion of the dataset applies to the current cohort, you
can define a filter (<code>cf</code> field). This will be 
applied to the dataset to only return values relevant to this cohort. For
example, if we only want records where the column <code>DOSE</code> is 5 (for the 5
mpk cohort). We can use the following:</p>
<pre><span class='va'>cohort</span><span class='op'>[[</span><span class='st'>"cf"</span><span class='op'>]</span><span class='op'>]</span>   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>DOSE   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span></pre>

<p>If the dataset has the headings <code>ID</code>, <code>DOSE</code> and <code>SEX</code>  and
cohort filter had the following format:</p>
<pre><span class='va'>cohort</span><span class='op'>[[</span><span class='st'>"cf"</span><span class='op'>]</span><span class='op'>]</span>   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ID    <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span>,
                        DOSE  <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>,<span class='fl'>10</span><span class='op'>)</span>,
                        SEX   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></pre>

<p>It would be translated into the boolean filter:</p>
<pre>(ID==1) | (ID==2) | (ID==3) | (ID==4)) &amp; ((DOSE == 5) | (DOSE==10)) &amp; (SEX == 1)</pre>

<p>Optionally you may want to fix a system parameter to a different value for a
given cohort. This can be done using the cohort parameter (<code>cp</code>) field.
For example if you had the body weight defined as a system parameter 
(<code>BW</code>), and you wanted to fix the body weight to 70 for the current
cohort you would do the following:</p>
<pre><span class='va'>cohort</span><span class='op'>[[</span><span class='st'>"cp"</span><span class='op'>]</span><span class='op'>]</span>   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>BW        <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>70</span><span class='op'>)</span><span class='op'>)</span></pre>

<p>Note that you can only fix parameters that are not being estimated.</p>
<p>By default the underlying simulation output times will be taken from the
general output_times option (see <code><a href='system_set_option.html'>system_set_option</a></code>). However It may also be 
necessary to specify simulation output times for a specific cohort. The
<code>output_times</code> field can be used for this. Simply provide a vector of
 output times:</p>
<pre><span class='va'>cohort</span><span class='op'>[[</span><span class='st'>"output_times"</span><span class='op'>]</span><span class='op'>]</span>   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>100</span>,<span class='fl'>2</span><span class='op'>)</span></pre>

<p>Next we define the dosing for this cohort. It is only necessary to define
those inputs that are non-zero. So if the data here were generated from
animals given a single 5 mpk IV at time 0. Bolus dosing is defined 
using <code>&lt;B:times&gt;</code> and <code>&lt;B:events&gt;</code>. If <code>Cp</code> is the central
compartment, you would pass this information to the cohort in the
following manner:</p>
<pre><span class='va'>cohort</span><span class='op'>[[</span><span class='st'>"inputs"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"bolus"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>cohort</span><span class='op'>[[</span><span class='st'>"inputs"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"bolus"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"Cp"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>TIME<span class='op'>=</span><span class='cn'>NULL</span>, AMT<span class='op'>=</span><span class='cn'>NULL</span><span class='op'>)</span>
<span class='va'>cohort</span><span class='op'>[[</span><span class='st'>"inputs"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"bolus"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"Cp"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"TIME"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span> <span class='fl'>0</span><span class='op'>)</span> 
<span class='va'>cohort</span><span class='op'>[[</span><span class='st'>"inputs"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"bolus"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"Cp"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"AMT"</span><span class='op'>]</span><span class='op'>]</span>  <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span> <span class='fl'>5</span><span class='op'>)</span></pre>
 
<p>Inputs can also include any infusion rates (<code>infusion_rates</code>) or
covariates (<code>covariates</code>). Covariates will have the default value
specified in the system file unless overwritten here. The units here are
the same as those in the system file</p> 
<p>Next we need to map the outputs in the model to the observation data in the
dataset. Under the <code>outputs</code> field there is a field for each output. Here 
the field <code>ONAME</code> can be replaced with something more useful (like 
<code>PK</code>).</p>
<pre><span class='va'>cohort</span><span class='op'>[[</span><span class='st'>"outputs"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"ONAME"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span></pre>

<p>If you want to further filter the dataset. Say for example you
have two outputs and the <code>cf</code> applied above reduces your dataset
down to both outputs. Here you can use the  "of" field to apply an "output filter"
to further filter the records down to those that apply to the current output ONAME.</p><pre><span class='va'>cohort</span><span class='op'>[[</span><span class='st'>"outputs"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"ONAME"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"of"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
       COLNAME          <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>)</span>,
       COLNAME          <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></pre><p>If you do not need further filtering of data, you can you can just omit the field.</p>
<p>Next you need to identify the columns in the dataset that contain your
times and observations. This is found in the <code>obs</code> field for the 
current observation:</p><pre><span class='va'>cohort</span><span class='op'>[[</span><span class='st'>"outputs"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"ONAME"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"obs"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
         time           <span class='op'>=</span> <span class='st'>"TIMECOL"</span>,
         value          <span class='op'>=</span> <span class='st'>"OBSCOL"</span>,
         missing        <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span></pre>

<p>The times and observations in the dataset are found in the <code>’TIMECOL’</code> column 
and the <code>’OBSCOL’</code> column (optional missing data option specified by -1).</p>
<p>These observations in the dataset need to be mapped to the appropriate
elements of your model defined in the system file. This is done with the
<code>model</code> field:</p>
<pre><span class='va'>cohort</span><span class='op'>[[</span><span class='st'>"outputs"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"ONAME"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"model"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
         time           <span class='op'>=</span> <span class='st'>"TS"</span>,       
         value          <span class='op'>=</span> <span class='st'>"MODOUTPUT"</span>,
         variance       <span class='op'>=</span> <span class='st'>"PRED^2"</span><span class='op'>)</span></pre>

<p>First the system time scale indicated by the <code>TS</code> placeholder above
must be specfied. The time scale must correspond to the data found in
<code>TIMECOL</code> above.  Next the model output indicated by the <code>MODOUTPUT</code>
placeholder needs to be specified. This is defined in the system file using
<code>&lt;O&gt;</code> and should correspond to <code>OBSCOL</code> from the dataset. Lastly the
<code>variance</code> field specifies the variance model. You can use the keyword
<code>PRED</code> (the model predicted output) and any variance parameters. Some
examples include:</p>
<ul>
<li><p><code>variance = "1"</code> - Least squares</p></li>
<li><p><code>variance = "PRED^2"</code> -  Weighted least squares proportional to the prediction squared</p></li>
<li><p><code>variance = "(SLOPE*PRED)^2"</code>  Maximum likelihood estimation where <code>SLOPE</code> is defined as a variance parameter (<code>&lt;VP&gt;</code>)</p></li>
</ul>

<p>The following controls the plotting aspects associated with this output. The
color, shape and line values are the values used by ggplot functions.</p>
<pre><span class='va'>cohort</span><span class='op'>[[</span><span class='st'>"outputs"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"ONAME"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='st'>"options"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
        marker_color   <span class='op'>=</span> <span class='st'>"black"</span>,
        marker_shape   <span class='op'>=</span> <span class='fl'>16</span>,
        marker_line    <span class='op'>=</span> <span class='fl'>1</span> <span class='op'>)</span></pre>

<p>If the cohort has multiple outputs, simply repeat the process above for the. 
additional cohorts. The estimation vignettes contains examples of this.</p>
<p><b>Note: Output names should be consistent between cohorts so they will be grouped together when plotting results.</b></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Estimation vignette (<code><a href='../articles/Estimation.html'>vignette("Estimation", package = "ubiquity")</a></code>)</p></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by John Harrold.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


